<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin Dashboard - Direcci√≥n de Turismo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!--  Librer√≠a XLSX para descarga Excel -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Agregar en el <head> -->


    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* üé® NUEVO FONDO BLANCO ELEGANTE */
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
            color: #2d3748;
        }
        
        /* üé® ELEMENTOS FLOTANTES ADAPTADOS PARA FONDO BLANCO */
        .floating-element {
            position: fixed;
            opacity: 0.08;
            animation: float 6s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
            color: #cbd5e0;
        }
        .floating-element:nth-child(1) {
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }
        .floating-element:nth-child(2) {
            top: 60%;
            right: 10%;
            animation-delay: -2s;
        }
        .floating-element:nth-child(3) {
            bottom: 20%;
            left: 15%;
            animation-delay: -4s;
        }
        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
            }
        }
        /* Sidebar */
        .sidebar {
            width: 280px;
            /* üé® SIDEBAR CON FONDO OSCURO PARA CONTRASTE */
            background: linear-gradient(180deg, #2d3748 0%, #1a202c 100%);
            color: white;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        }
        .sidebar.active {
            transform: translateX(0);
        }
        .user-profile {
            padding: 2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.8rem;
            color: #4299e1;
            position: relative;
            box-shadow: 0 4px 15px rgba(246, 173, 85, 0.8);
        }
        .crown-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f6ad55;
            color: #1a365d;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }
        .user-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: white;
        }
        .user-role {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #f6ad55;
            font-weight: 500;
        }
        .sidebar-menu {
            padding: 1rem 0;
            list-style: none;
        }
        .menu-section {
            padding: 0.5rem 1.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 1rem;
        }
        .menu-item {
            margin: 0.2rem 0;
        }
        .menu-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.8rem 1.5rem;
            color: #e2e8f0;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            position: relative;
        }
        .menu-link:hover, .menu-link.active {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #f6ad55;
            color: white;
        }
        .menu-link i {
            width: 20px;
            text-align: center;
        }
        .logout-section {
            margin-top: auto;
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .logout-btn {
            width: 100%;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fed7d7;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
            /* üé® FONDO PRINCIPAL ADAPTADO */
            background: rgba(255, 255, 255, 0.05);
            min-height: 100vh;
            transition: all 0.3s ease;
        }
        
        /* Header Bar */
        .header-bar {
            /* üé® HEADER CON FONDO BLANCO SEMITRANSPARENTE */
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(203, 213, 224, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }
        .page-title {
            font-size: 2rem;
            font-weight: 700;
            /* üé® COLOR DE TEXTO OSCURO */
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .crown-icon {
            color: #f6ad55;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(246, 173, 85, 0.5); }
            to { text-shadow: 0 0 20px rgba(246, 173, 85, 0.8); }
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            /* üé® CARDS CON FONDO BLANCO */
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(226, 232, 240, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        .stat-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .stat-icon {
            font-size: 2rem;
            color: var(--card-color);
            background: rgba(var(--card-color-rgb), 0.1);
            padding: 0.8rem;
            border-radius: 10px;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            /* üé® N√öMEROS OSCUROS */
            color: #2d3748;
        }
        .stat-label {
            /* üé® ETIQUETAS GRISES */
            color: #718096;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Content Sections */
        .content-section {
            /* üé® SECCIONES CON FONDO BLANCO */
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid rgba(226, 232, 240, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        .section-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
            background: rgba(247, 250, 252, 0.8);
        }
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            /* üé® T√çTULOS OSCUROS */
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title i {
            color: #4299e1;
        }
        .section-content {
            padding: 2rem;
        }
        
        /* Action Buttons */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .action-btn {
            background: linear-gradient(135deg, var(--btn-color, #4299e1), var(--btn-color-dark, #3182ce));
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
        }
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .action-btn.pdf { --btn-color: #e53e3e; --btn-color-dark: #c53030; }
        .action-btn.view { --btn-color: #3182ce; --btn-color-dark: #2c5aa0; }

        /* üî• NUEVOS ESTILOS PARA REPORTES EXCEL */
        .download-section {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border-left: 4px solid #28a745;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .download-section h3 {
            margin-bottom: 1.5rem;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
        }
        
        .excel-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #218838 0%, #1abc9c 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0056b3 0%, #520dc2 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #138496 0%, #1abc9c 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);
        }
        
        .excel-info {
            margin-top: 1.5rem;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .excel-info div {
            margin-bottom: 0.8rem;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .excel-info strong {
            color: #495057;
            min-width: 140px;
        }
        
        /* Data Table */
        .data-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 12px;
            overflow: hidden;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid rgba(226, 232, 240, 0.5);
        }
        .data-item {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .data-item:last-child {
            border-bottom: none;
        }
        .data-item:nth-child(even) {
            background: rgba(247, 250, 252, 0.8);
        }
        .data-info {
            flex: 1;
        }
        .data-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }
        .data-details {
            font-size: 0.9rem;
            color: #718096;
        }
        .data-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }
        .status-inactive {
            background: #fed7d7;
            color: #822727;
        }
        
        /* üî• NUEVOS ESTILOS PARA BOTONES DE ACCI√ìN MEJORADOS */
        .data-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: flex-end;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .btn-toggle {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .btn-toggle.block {
            background: #fed7d7;
            color: #822727;
        }
        .btn-toggle.activate {
            background: #c6f6d5;
            color: #22543d;
        }
        .btn-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* üî• NUEVO: Estilos para el bot√≥n de eliminar */
        .btn-delete {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            background: #fed7d7;
            color: #822727;
        }
        
        .btn-delete:hover {
            background: #e53e3e;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(229, 62, 62, 0.3);
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }
        .loading i {
            font-size: 2rem;
            margin-bottom: 1rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* ‚úÖ ESTILOS MEJORADOS PARA REPORTES */
        .reports-container {
            max-width: 100%;
            margin: 0 auto;
        }
        .reports-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.5);
        }
        .reports-info h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }
        .reports-info p {
            color: #718096;
            margin: 0;
        }
        .reports-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        /* ‚úÖ FILTROS MEJORADOS */
        .filters-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border: 1px solid #dee2e6;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .filter-group label {
            font-weight: 600;
            font-size: 0.9rem;
            color: #495057;
        }
        .filter-group select {
            padding: 0.75rem;
            border: 2px solid #ced4da;
            border-radius: 8px;
            background: white;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }
        .filter-group select:focus {
            border-color: #007bff;
            outline: none;
        }
        .filter-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
            grid-column: 1 / -1;
            font-weight: 500;
        }
        
        /* ‚úÖ ESTAD√çSTICAS MEJORADAS */
        .reports-summary {
            margin-bottom: 2rem;
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1rem;
        }
        .summary-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        .summary-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .summary-content h3 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .summary-content p {
            margin: 0;
            color: #6c757d;
            font-size: 1rem;
            font-weight: 500;
        }
        
        /* ‚úÖ TABLA COMPLETAMENTE REDISE√ëADA */
        .reports-table-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }
        
        /* NUEVA VISTA TIPO CARDS PARA REPORTES */
        .reports-grid {
            display: none; /* Oculta por defecto, se muestra en m√≥vil */
        }
        
        .report-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .report-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .report-establishment {
            flex: 1;
        }
        
        .establishment-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }
        
        .establishment-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .establishment-location {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .report-period {
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #495057;
            text-align: center;
            min-width: 120px;
        }
        
        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
            display: block;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
        
        .report-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }
        
        /* ‚úÖ TABLA OPTIMIZADA PARA DESKTOP */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1rem 0.75rem;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .data-table td {
            padding: 1rem 0.75rem;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: middle;
        }
        .data-table tr:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        /* ‚úÖ COLUMNAS ESPEC√çFICAS OPTIMIZADAS */
        .establishment-column {
            min-width: 200px;
            max-width: 250px;
        }
        
        .type-column {
            width: 100px;
            text-align: center;
        }
        
        .period-column {
            width: 130px;
        }
        
        .stats-column {
            width: 90px;
            text-align: center;
            font-weight: 600;
        }
        
        .procedencia-column {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: help;
        }
        
        .actions-column {
            width: 120px;
            text-align: center;
        }
        
        /* ‚úÖ BOTONES DE ACCI√ìN MEJORADOS */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
        }
        
        .btn-download-single, .btn-view-details {
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            min-width: 80px;
            justify-content: center;
        }
        
        .btn-download-single {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }
        
        .btn-download-single:hover {
            background: linear-gradient(135deg, #218838 0%, #1abc9c 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }
        
        .btn-view-details {
            background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
        
        .btn-view-details:hover {
            background: linear-gradient(135deg, #0056b3 0%, #520dc2 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
        }
        
        /* ‚úÖ BADGES MEJORADOS */
        .badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge-hotel { 
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); 
            color: #1976d2; 
            border: 1px solid #2196f3;
        }
        .badge-cabana { 
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c8 100%); 
            color: #2e7d32; 
            border: 1px solid #4caf50;
        }
        .badge-airbnb { 
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); 
            color: #c2185b; 
            border: 1px solid #e91e63;
        }
        
        /* ‚úÖ INFORMACI√ìN DEL ESTABLECIMIENTO */
        .establecimiento-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .establecimiento-info strong { 
            color: #2c3e50; 
            font-size: 1rem;
            font-weight: 600;
        }
        
        .establecimiento-info small {
            color: #6c757d;
            font-size: 0.85rem;
        }
        
        .periodo-info { 
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .periodo-info small {
            display: block;
            color: #495057;
        }
        
        /* ‚úÖ ESTAD√çSTICAS EN CELDAS */
        .stats-cell {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .stats-cell.success {
            color: #28a745;
        }
        
        .stats-cell.primary {
            color: #007bff;
        }
        
        .stats-cell.info {
            color: #17a2b8;
        }
        
        
        /* ‚úÖ EMPTY STATE Y LOADING MEJORADOS */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #718096;
            animation: fadeIn 0.5s ease-out;
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: rgba(113, 128, 150, 0.5);
        }
        .empty-state h3 {
            font-size: 1.5rem;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }
        
        .loading {
            text-align: center;
            padding: 4rem 2rem;
            color: #718096;
        }
        .loading i {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            animation: spin 1s linear infinite;
            color: #007bff;
        }
        .loading p {
            font-size: 1.1rem;
            color: #495057;
            margin: 0;
        }
        
        /* ‚úÖ NOTIFICACIONES MEJORADAS */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .notification.show {
            display: flex;
            animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .notification.error {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            box-shadow: 0 8px 25px rgba(229, 62, 62, 0.3);
        }
        .notification.warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            box-shadow: 0 8px 25px rgba(237, 137, 54, 0.3);
        }
        .notification.info {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            box-shadow: 0 8px 25px rgba(66, 153, 225, 0.3);
        }
        
        /* ‚úÖ MEJORAS ADICIONALES */
        .table-responsive::-webkit-scrollbar {
            height: 8px;
        }
        .table-responsive::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .table-responsive::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);
            border-radius: 4px;
        }
        .table-responsive::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #0056b3 0%, #520dc2 100%);
        }
        /* ‚úÖ RESPONSIVE DESIGN COMPLETO */
        @media (max-width: 1200px) {
            .data-table {
                font-size: 0.85rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.5rem 0.4rem;
            }
            
            .btn-download-single, .btn-view-details {
                padding: 0.4rem 0.6rem;
                font-size: 0.8rem;
                min-width: 70px;
            }
            
            .procedencia-column {
                max-width: 150px;
            }
            
            .establishment-column {
                min-width: 180px;
            }
        }
        
        @media (max-width: 992px) {
            /* Ocultar tabla y mostrar cards en tablets */
            .reports-table-container .table-responsive {
                display: none;
            }
            
            .reports-grid {
                display: block !important;
            }
            
            .filters-section {
                grid-template-columns: 1fr 1fr;
            }
            
            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .reports-actions {
                flex-wrap: wrap;
                gap: 0.75rem;
            }
            
            .reports-header {
                padding: 1rem;
            }
        }
        
        @media (max-width: 768px) {
            .reports-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .reports-actions {
                justify-content: center;
                width: 100%;
            }
            
            .filters-section {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .filter-info {
                text-align: center;
            }
            
            .btn-download-single, .btn-view-details {
                flex: 1;
                justify-content: center;
            }
            
            .report-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .report-actions {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .report-actions .btn-download-single,
            .report-actions .btn-view-details {
                width: 100%;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .reports-container {
                margin: 0;
            }
        }
        
        @media (max-width: 480px) {
            .summary-card {
                padding: 1rem;
                gap: 1rem;
            }
            
            .summary-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .summary-content h3 {
                font-size: 2rem;
            }
            
            .establishment-name {
                font-size: 1rem;
            }
            
            .report-stats {
                grid-template-columns: 1fr;
            }
            
            .notification {
                right: 10px;
                left: 10px;
                width: auto;
            }
        }
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #718096, #4a5568);
            color: white;
        }
        .btn-outline {
            background: transparent;
            border: 1px solid #e2e8f0;
            color: #4a5568;
        }
        .btn-download {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border: none;
        }
        .btn-info {
            background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);
            border: none;
        }
        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.875rem;
        }
        .btn-view {
            background: #3182ce;
            color: white;
        }
        .btn-download-single {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-download-single:hover {
            background: #218838;
            transform: scale(1.05);
        }
        .btn-view-details {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: 0.25rem;
            transition: all 0.2s;
        }
        .btn-view-details:hover {
            background: #0056b3;
            transform: scale(1.05);
        }
        .report-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Action buttons in table */
        .btn-action {
            padding: 0.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        .btn-action.view {
            background: #3182ce;
            color: white;
        }
        .btn-action.download {
            background: #48bb78;
            color: white;
        }
        .btn-action.print {
            background: #ed8936;
            color: white;
        }
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Estilos para procedencia y modal */
        .procedencia-column {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: help;
        }
        .establecimiento-info strong { color: #2c3e50; }
        .periodo-info { font-size: 0.85rem; }
        
        /* Badges para tipos */
        .badge {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-hotel { background: #e3f2fd; color: #1976d2; }
        .badge-cabana { background: #e8f5e8; color: #2e7d32; }
        .badge-airbnb { background: #fce4ec; color: #c2185b; }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        .modal-content {
            background: white;
            border-radius: 10px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .large-modal .modal-content { max-width: 90vw; width: 1000px; }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            background: #4299e1;
            color: white;
            border-radius: 10px 10px 0 0;
        }
        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-body {
            padding: 20px;
        }
        .modal-info {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 5px;
        }
        .modal-info p {
            margin: 5px 0;
            color: #333;
        }
        .modal-data h3 {
            color: #4299e1;
            margin-bottom: 15px;
        }
        .modal-data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .modal-data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 5px;
            border-left: 3px solid #4299e1;
        }
        .modal-data-label {
            font-weight: 500;
            color: #333;
        }
        .modal-data-value {
            font-weight: 600;
            color: #4299e1;
            font-size: 1.1em;
        }
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        /* Report details modal */
        .report-details-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 1.5rem; 
            margin-bottom: 1.5rem;
        }
        .full-width { grid-column: 1 / -1; }
        .detail-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
        }
        .detail-section h3 {
            margin: 0 0 1rem 0;
            color: #495057;
            font-size: 1rem;
        }
        .detail-item {
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }
        .detail-item:last-child { border-bottom: none; margin-bottom: 0; }
        .procedencia-full, .notas-full {
            background: white;
            padding: 1rem;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            line-height: 1.5;
        }
        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            font-size: 1.2rem;
        }
        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }
        
        /* Mobile Menu */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1100;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(203, 213, 224, 0.3);
            color: #2d3748;
            padding: 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .overlay.active {
            display: block;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .notification.show {
            display: flex;
            animation: slideIn 0.3s ease;
        }
        .notification.error {
            background: #e53e3e;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* Color variations for different card types */
        .stat-card.hotels { --card-color: #4299e1; --card-color-rgb: 66, 153, 225; }
        .stat-card.cabanas { --card-color: #48bb78; --card-color-rgb: 72, 187, 120; }
        .stat-card.airbnb { --card-color: #ed8936; --card-color-rgb: 237, 137, 54; }
        .stat-card.tours { --card-color: #9f7aea; --card-color-rgb: 159, 122, 234; }
        .stat-card.guias { --card-color: #38b2ac; --card-color-rgb: 56, 178, 172; }

/* üî• NUEVA SECCI√ìN: AGREGAR NUEVOS ESTABLECIMIENTOS */
/* Agregar esta secci√≥n en el super-admin-dashboard.html despu√©s de las estad√≠sticas */
.section-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    margin-bottom: 2rem;
    border: 1px solid rgba(226, 232, 240, 0.5);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow: hidden;
}
/* üé® ESTILOS PARA LA NUEVA SECCI√ìN */
.create-header {
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid rgba(226, 232, 240, 0.3);
}
.create-buttons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
}
.create-btn {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 15px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
    width: 100%;
}
.create-btn:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    border-color: var(--btn-color);
}
.create-btn-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    background: var(--btn-color);
}
.create-btn-content {
    flex: 1;
}
.create-btn-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
}
.create-btn-desc {
    font-size: 0.9rem;
    color: #718096;
}
/* Colores espec√≠ficos por tipo */
.hotel-btn { --btn-color: #3182ce; }
.hotel-btn:hover { border-color: #3182ce; background: rgba(49, 130, 206, 0.05); }
.cabana-btn { --btn-color: #38a169; }
.cabana-btn:hover { border-color: #38a169; background: rgba(56, 161, 105, 0.05); }
.airbnb-btn { --btn-color: #e53e3e; }
.airbnb-btn:hover { border-color: #e53e3e; background: rgba(229, 62, 62, 0.05); }
.guia-btn { --btn-color: #805ad5; }
.guia-btn:hover { border-color: #805ad5; background: rgba(128, 90, 213, 0.05); }
.tour-btn { --btn-color: #d69e2e; }
.tour-btn:hover { border-color: #d69e2e; background: rgba(214, 158, 46, 0.05); }
/* üî• ESTILOS DEL MODAL */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
}
.modal-content {
    background-color: white;
    margin: 2% auto;
    border-radius: 15px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}
.modal-header {
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
    padding: 1.5rem 2rem;
    border-radius: 15px 15px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.modal-header h2 {
    margin: 0;
    font-size: 1.3rem;
}
.close {
    color: white;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    opacity: 0.8;
    transition: opacity 0.3s;
}
.close:hover {
    opacity: 1;
}
.modal-body {
    padding: 2rem;
}
.form-group {
    margin-bottom: 1.5rem;
}
.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #2d3748;
}
.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #4299e1;
}
.form-hint {
    font-size: 0.8rem;
    color: #718096;
    margin-top: 0.25rem;
    display: block;
}
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}
.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid #e2e8f0;
}
.btn-cancel {
    background: #718096;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
}
.btn-cancel:hover {
    background: #4a5568;
}
.btn-create {
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.3s;
}
.btn-create:hover {
    transform: translateY(-2px);
}
/* üî• NUEVO: Banner informativo */
.info-banner {
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
    padding: 1rem;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}
.info-banner-icon {
    font-size: 1.5rem;
    margin-top: 0.25rem;
}
.info-banner-content h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1rem;
    font-weight: 600;
}
.info-banner-content p {
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.4;
    opacity: 0.95;
}
.info-banner-content strong {
    font-weight: 600;
}
/* üî• NUEVOS ESTILOS: Modal de usuario creado */
.success-info {
    text-align: center;
}
.user-credentials {
    background: #f7fafc;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 1.5rem;
    margin: 1.5rem 0;
    text-align: left;
}
.user-credentials h4 {
    margin: 0 0 1rem 0;
    color: #2d3748;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.credential-item {
    margin-bottom: 1rem;
}
.credential-item label {
    display: block;
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}
.credential-value {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: white;
    border: 1px solid #cbd5e0;
    border-radius: 8px;
    padding: 0.75rem;
    font-family: 'Courier New', monospace;
    font-size: 0.95rem;
}
.password-value {
    font-weight: 600;
    color: #e53e3e;
    letter-spacing: 1px;
}
.copy-btn {
    background: #4299e1;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 0.25rem 0.5rem;
    cursor: pointer;
    font-size: 0.8rem;
    transition: background 0.3s;
}
.copy-btn:hover {
    background: #3182ce;
}
.important-note {
    background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
    border: 1px solid #fc8181;
    border-radius: 10px;
    padding: 1rem;
    margin: 1.5rem 0;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    text-align: left;
}
.important-note i {
    color: #e53e3e;
    font-size: 1.5rem;
    margin-top: 0.25rem;
}
.important-note strong {
    color: #c53030;
}
.important-note p {
    margin: 0.5rem 0 0 0;
    font-size: 0.9rem;
    color: #742a2a;
    line-height: 1.4;
}
/* Animaci√≥n para el feedback de copiado */
@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            .mobile-menu-toggle {
                display: block;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .actions-grid {
                grid-template-columns: 1fr;
            }
            .reports-header {
                flex-direction: column;
                gap: 1rem;
            }
            .filters-section {
                flex-direction: column;
            }
            .data-actions {
                flex-direction: column;
                gap: 0.3rem;
            }
            .create-buttons-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
            }
            .summary-cards {
                grid-template-columns: 1fr;
            }
            .reports-actions {
                flex-direction: column;
            }
        }
/* Agregar al final de la secci√≥n <style> existente: */

/* ==================== ESTILOS PARA ESTAD√çSTICAS ==================== */
.statistics-filters {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.filters-title {
    color: var(--primary-color);
    font-size: 1.3rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    align-items: end;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-group label {
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--primary-color);
}

.comparison-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 10px;
    margin-bottom: 30px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.1);
}

.comparison-title {
    font-size: 1.4rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.comparison-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.comparison-card {
    background: rgba(255,255,255,0.15);
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    backdrop-filter: blur(10px);
}

.comparison-value {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.comparison-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.trend-up { color: #2ecc71; }
.trend-down { color: #e74c3c; }
.trend-neutral { color: #95a5a6; }

.statistics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-card-header {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    padding: 20px;
}

.stat-card-header h4 {
    margin: 0;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.stat-card-subtitle {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-top: 5px;
}

.stat-card-body {
    padding: 25px;
}

.chart-container {
    position: relative;
    height: 300px;
    margin-bottom: 20px;
}

.chart-metrics {
    display: flex;
    justify-content: space-around;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
}

.metric-item {
    text-align: center;
}

.metric-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--secondary-color);
}

.metric-label {
    font-size: 0.8rem;
    color: #6c757d;
    text-transform: uppercase;
}

.export-section {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    text-align: center;
}

.export-section h3 {
    color: var(--primary-color);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.export-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.loading-stats {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px;
    font-size: 1.1rem;
    opacity: 0.7;
}

.loading-stats::after {
    content: '';
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-left: 10px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
    .statistics-grid {
        grid-template-columns: 1fr;
    }
    
    .filters-grid {
        grid-template-columns: 1fr;
    }
    
    .export-buttons {
        flex-direction: column;
    }
    
    .chart-container {
        height: 250px;
    }
}


    </style>
</head>
<body>
    <!-- Floating Elements -->
    <div class="floating-element">
        <i class="fas fa-compass" style="font-size: 3rem;"></i>
    </div>
    <div class="floating-element">
        <i class="fas fa-map-marker-alt" style="font-size: 2.5rem;"></i>
    </div>
    <div class="floating-element">
        <i class="fas fa-suitcase-rolling" style="font-size: 2rem;"></i>
    </div>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>
    <!-- Overlay for Mobile -->
    <div class="overlay" id="overlay"></div>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="user-profile">
            <div class="user-avatar">
                <div class="crown-badge">
                    <i class="fas fa-crown"></i>
                </div>
                <span id="userInitials">SA</span>
            </div>
            <div class="user-name" id="userName">Super Administrador</div>
            <div class="user-role">
                <i class="fas fa-crown"></i>
                <span>Super Admin</span>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li class="menu-section">Dashboard</li>
            <li class="menu-item">
                <a href="#" class="menu-link active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Resumen General</span>
                </a>
            </li>
            <li class="menu-section">Gesti√≥n</li>
            <li class="menu-item">
                <a href="#" class="menu-link" onclick="showSection('hoteles')">
                    <i class="fas fa-hotel"></i>
                    <span>Todos los Hoteles</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="#" class="menu-link" onclick="showSection('cabanas')">
                    <i class="fas fa-tree"></i>
                    <span>Todas las Caba√±as</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="#" class="menu-link" onclick="showSection('airbnb')">
                    <i class="fas fa-home"></i>
                    <span>Todos los Airbnb</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="#" class="menu-link" onclick="showSection('tours')">
                    <i class="fas fa-route"></i>
                    <span>Todas las Tours</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="#" class="menu-link" onclick="showSection('guias')">
                    <i class="fas fa-user-tie"></i>
                    <span>Todas las Gu√≠as</span>
                </a>
            </li>
            <li class="menu-section">Reportes</li>
            <li class="menu-item">
                <a href="#" class="menu-link" onclick="showSection('reportes')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Generar Reportes</span>
                </a>
            </li>

            <!-- En el men√∫ de navegaci√≥n existente, agregar: -->
<li class="menu-item">
    <a href="#" class="menu-link" onclick="showSection('estadisticas')">
        <i class="fas fa-chart-line"></i>
        <span>Estad√≠sticas Avanzadas</span>
    </a>
</li>


            <li class="menu-item">
                <a href="#" class="menu-link" onclick="showSection('reportes-hoteles')">
                    <i class="fas fa-file-alt"></i>
                    <span>Reportes Semanales</span>
                </a>
            </li>
        </ul>
        <div class="logout-section">
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Cerrar Sesi√≥n</span>
            </button>
        </div>
    </aside>
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header Bar -->
        <div class="header-bar">
            <h1 class="page-title">
                <i class="fas fa-crown crown-icon"></i>
                Panel de Super Administraci√≥n
            </h1>
        </div>
        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="content-section">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card hotels">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-hotel"></i>
                            </div>
                            <div class="stat-number" id="totalHoteles">-</div>
                        </div>
                        <div class="stat-label">Total Hoteles</div>
                    </div>
                    <div class="stat-card cabanas">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-tree"></i>
                            </div>
                            <div class="stat-number" id="totalCabanas">-</div>
                        </div>
                        <div class="stat-label">Total Caba√±as</div>
                    </div>
                    <div class="stat-card airbnb">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <div class="stat-number" id="totalAirbnb">-</div>
                        </div>
                        <div class="stat-label">Total Airbnb</div>
                    </div>
                    <div class="stat-card tours">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-route"></i>
                            </div>
                            <div class="stat-number" id="totalTours">-</div>
                        </div>
                        <div class="stat-label">Total Tours</div>
                    </div>
                    <div class="stat-card guias">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="stat-number" id="totalGuias">-</div>
                        </div>
                        <div class="stat-label">Total Gu√≠as</div>
                    </div>
                </div>
<!--  SECCI√ìN: AGREGAR NUEVOS ESTABLECIMIENTOS -->
<div class="section-card" id="createNewSection">
    <div class="section-header create-header">
        <div class="section-title">
            <i class="fas fa-plus-circle"></i>
            Agregar Nuevos Establecimientos
        </div>
    </div>
    <div class="section-content">
        <div class="create-buttons-grid">
            <!-- Hotel -->
            <button class="create-btn hotel-btn" onclick="openCreateModal('hotel')">
                <div class="create-btn-icon">
                    <i class="fas fa-hotel"></i>
                </div>
                <div class="create-btn-content">
                    <div class="create-btn-title">Nuevo Hotel</div>
                    <div class="create-btn-desc">Agregar un nuevo hotel</div>
                </div>
            </button>
            <!-- Caba√±a -->
            <button class="create-btn cabana-btn" onclick="openCreateModal('cabana')">
                <div class="create-btn-icon">
                    <i class="fas fa-tree"></i>
                </div>
                <div class="create-btn-content">
                    <div class="create-btn-title">Nueva Caba√±a</div>
                    <div class="create-btn-desc">Agregar una nueva caba√±a</div>
                </div>
            </button>
            <!-- Airbnb -->
            <button class="create-btn airbnb-btn" onclick="openCreateModal('airbnb')">
                <div class="create-btn-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div class="create-btn-content">
                    <div class="create-btn-title">Nuevo Alojamiento</div>
                    <div class="create-btn-desc">Agregar alojamiento Airbnb</div>
                </div>
            </button>
            <!-- Gu√≠a Tur√≠stica -->
            <button class="create-btn guia-btn" onclick="openCreateModal('guiaturistica')">
                <div class="create-btn-icon">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="create-btn-content">
                    <div class="create-btn-title">Nueva Gu√≠a</div>
                    <div class="create-btn-desc">Agregar gu√≠a tur√≠stica</div>
                </div>
            </button>
            <!-- Tour Operadora -->
            <button class="create-btn tour-btn" onclick="openCreateModal('touroperadora')">
                <div class="create-btn-icon">
                    <i class="fas fa-route"></i>
                </div>
                <div class="create-btn-content">
                    <div class="create-btn-title">Nueva Tour Operadora</div>
                    <div class="create-btn-desc">Agregar tour operadora</div>
                </div>
            </button>
        </div>
    </div>
</div>
<!-- üî• MODAL PARA CREAR NUEVOS ESTABLECIMIENTOS -->
<div id="createModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Crear Nuevo Establecimiento</h2>
            <span class="close" onclick="closeCreateModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- üî• NUEVA INFORMACI√ìN IMPORTANTE -->
            <div class="info-banner">
                <div class="info-banner-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="info-banner-content">
                    <h4>Creaci√≥n autom√°tica de usuario</h4>
                    <p>Al crear este establecimiento, se generar√° autom√°ticamente una <strong>cuenta de usuario</strong> para el propietario con una <strong>contrase√±a temporal</strong> que le permitir√° acceder y gestionar su establecimiento.</p>
                </div>
            </div>
            
            <form id="createForm">
                <!-- Contenido din√°mico seg√∫n el tipo -->
                <div id="dynamicFormContent"></div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeCreateModal()">Cancelar</button>
                    <button type="submit" class="btn-create">Crear Establecimiento + Usuario</button>
                </div>
            </form>
        </div>
    </div>
</div>
            </div>
            
            <!-- REPORTES SECTION - CON FUNCIONES EXCEL -->
            <div id="reportes-section" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-file-pdf"></i>
                        Generar Reportes
                    </h2>
                </div>
          

                    <!-- üî• NUEVA SECCI√ìN EXCEL INTEGRADA -->
                    <div class="download-section">
                        <h3>
                            <i class="fas fa-file-excel" style="color: #28a745;"></i> 
                            Reportes de hospedajes
                        </h3>
                        <div class="excel-buttons">
                            <button class="btn btn-success" onclick="downloadHospedajesIndividualExcel()">
                                <i class="fas fa-building"></i>
                                Reporte Individual de Hospedajes
                            </button>
                            <button class="btn btn-primary" onclick="downloadHospedajesTotalExcel()">
                                <i class="fas fa-chart-bar"></i>
                                Reporte Total Consolidado
                            </button>
                           
                        </div>
                        <div class="excel-info">
                            <div>
                                <strong> Reporte Individual:</strong> Informaci√≥n completa de cada hospedaje (nombre, ubicaci√≥n, precios, habitaciones, tel√©fono, correo, horario, servicios, m√©todos de pago)
                            </div>
                            <div>
                                <strong>Reporte Total:</strong> Capacidad m√°xima total de personas y n√∫mero total de habitaciones de todos los hospedajes
                            </div>
                            <div>
                                <strong> Ambos Reportes:</strong> Descarga los dos archivos Excel por separado
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            

<!-- Insertar DESPU√âS de todas las secciones existentes (despu√©s de reportes-hoteles-section): -->

<!-- ‚úÖ NUEVA SECCI√ìN: Estad√≠sticas Avanzadas -->
<div id="estadisticas-section" class="content-section" style="display: none;">
    <div class="section-header">
        <h2 class="section-title">
            <i class="fas fa-chart-line"></i>
            Estad√≠sticas Avanzadas de Hospedajes
        </h2>
        <p class="section-description">
            Panel de an√°lisis completo con gr√°ficos interactivos y comparaciones temporales
        </p>
    </div>
    
    <div class="section-content">
        <!-- Filtros para Estad√≠sticas -->
        <div class="statistics-filters">
            <h3 class="filters-title">
                <i class="fas fa-filter"></i> Filtros de An√°lisis
            </h3>
            
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="stats-tipo-establecimiento">Tipo de Establecimiento:</label>
                    <select id="stats-tipo-establecimiento" class="form-control">
                        <option value="todos">Todos los Establecimientos</option>
                        <option value="hotel">Hoteles</option>
                        <option value="cabana">Caba√±as</option>
                        <option value="airbnb">Airbnb</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="stats-periodo">Per√≠odo de An√°lisis:</label>
                    <select id="stats-periodo" class="form-control">
                        <option value="trimestre">√öltimo Trimestre</option>
                        <option value="semestre">√öltimo Semestre</option>
                        <option value="a√±o">√öltimo A√±o</option>
                        <option value="personalizado">Per√≠odo Personalizado</option>
                    </select>
                </div>

                <div class="filter-group" id="custom-dates" style="display: none;">
                    <label>Fechas Personalizadas:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="date" id="stats-fecha-inicio" class="form-control" placeholder="Fecha Inicio">
                        <input type="date" id="stats-fecha-fin" class="form-control" placeholder="Fecha Fin">
                    </div>
                </div>

                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary" onclick="generateAdvancedStatistics()">
                        <i class="fas fa-chart-bar"></i>
                        Generar Estad√≠sticas
                    </button>
                </div>
            </div>
        </div>

        <!-- Comparaci√≥n con Per√≠odo Anterior -->
        <div class="comparison-section">
            <h3 class="comparison-title">
                <i class="fas fa-calendar-alt"></i> Comparaci√≥n con Per√≠odo Anterior
            </h3>
            <div class="comparison-cards" id="comparison-metrics">
                <div class="loading-stats">Cargando datos de comparaci√≥n...</div>
            </div>
        </div>

        <!-- Grid de Gr√°ficos Estad√≠sticos -->
        <div class="statistics-grid">
            <!-- Gr√°fico 1: Fechas m√°s concurridas -->
            <div class="stat-card">
                <div class="stat-card-header">
                    <h4><i class="fas fa-calendar-check"></i> Fechas m√°s Concurridas</h4>
                    <div class="stat-card-subtitle">An√°lisis de temporadas y picos de ocupaci√≥n</div>
                </div>
                <div class="stat-card-body">
                    <div class="chart-container">
                        <canvas id="fechasChart"></canvas>
                    </div>
                    <div class="chart-metrics">
                        <div class="metric-item">
                            <span class="metric-value" id="total-semanas-analizadas">0</span>
                            <span class="metric-label">Semanas</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="pico-max-ocupacion">0</span>
                            <span class="metric-label">Pico M√°ximo</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="semanas-temporada-alta">0</span>
                            <span class="metric-label">Temp. Alta</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gr√°fico 2: Procedencia de turistas -->
            <div class="stat-card">
                <div class="stat-card-header">
                    <h4><i class="fas fa-globe-americas"></i> Procedencia de Turistas</h4>
                    <div class="stat-card-subtitle">An√°lisis de origen geogr√°fico de visitantes</div>
                </div>
                <div class="stat-card-body">
                    <div class="chart-container">
                        <canvas id="procedenciaChart"></canvas>
                    </div>
                    <div class="chart-metrics">
                        <div class="metric-item">
                            <span class="metric-value" id="total-lugares-origen">0</span>
                            <span class="metric-label">Lugares</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="lugar-principal">-</span>
                            <span class="metric-label">Principal</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="porcentaje-extranjeros">0%</span>
                            <span class="metric-label">Extranjeros</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gr√°fico 3: Tendencia Temporal -->
            <div class="stat-card">
                <div class="stat-card-header">
                    <h4><i class="fas fa-chart-line"></i> Tendencia Temporal</h4>
                    <div class="stat-card-subtitle">Evoluci√≥n mensual de ocupaci√≥n</div>
                </div>
                <div class="stat-card-body">
                    <div class="chart-container">
                        <canvas id="tendenciaChart"></canvas>
                    </div>
                    <div class="chart-metrics">
                        <div class="metric-item">
                            <span class="metric-value" id="promedio-mensual">0</span>
                            <span class="metric-label">Promedio</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="variacion-tendencia">0%</span>
                            <span class="metric-label">Variaci√≥n</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="direccion-tendencia">üìä</span>
                            <span class="metric-label">Tendencia</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gr√°fico 4: An√°lisis por Tipo -->
            <div class="stat-card">
                <div class="stat-card-header">
                    <h4><i class="fas fa-building"></i> An√°lisis por Tipo</h4>
                    <div class="stat-card-subtitle">Comparaci√≥n entre tipos de establecimiento</div>
                </div>
                <div class="stat-card-body">
                    <div class="chart-container">
                        <canvas id="tiposChart"></canvas>
                    </div>
                    <div class="chart-metrics">
                        <div class="metric-item">
                            <span class="metric-value" id="total-tipos-activos">0</span>
                            <span class="metric-label">Tipos</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="mejor-performance">-</span>
                            <span class="metric-label">Top</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-value" id="total-huespedes-periodo">0</span>
                            <span class="metric-label">Hu√©spedes</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botones de Exportaci√≥n -->
        <div class="export-section">
            <h3><i class="fas fa-download"></i> Exportar Estad√≠sticas</h3>
            <div class="export-buttons">
                <button class="btn btn-success" onclick="exportStatisticsExcel()">
                    <i class="fas fa-file-excel"></i>
                    Exportar a Excel
                </button>
              
                <button class="btn btn-warning" onclick="resetStatisticsFilters()">
                    <i class="fas fa-refresh"></i>
                    Restablecer Filtros
                </button>
            </div>
        </div>
    </div>
</div>


            <!--  Reportes Semanales por Establecimientos -->
            <div id="reportes-hoteles-section" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Reportes Semanales por Establecimientos
                    </h2>
                </div>
                <div class="section-content">
                    <div class="reports-container">
                        <div class="reports-header">
                            <div class="reports-info">
                                <h3>Reportes Recibidos de Establecimientos</h3>
                                <p>Visualice y descargue los cuestionarios semanales enviados por hoteles, caba√±as y Airbnb</p>
                            </div>
                            <!-- BOTONES -->
                            <div class="reports-actions">
                                <button class="btn btn-info" onclick="downloadFilteredReports()" id="downloadFilteredBtn">
                                    <i class="fas fa-filter"></i>
                                    Descargar Filtrados
                                </button>
                                <button class="btn btn-success" onclick="downloadAllReports()">
                                    <i class="fas fa-file-excel"></i>
                                    Descargar Todo Excel
                                </button>
                                <button class="btn btn-primary" onclick="loadReports()">
                                    <i class="fas fa-sync"></i>
                                    Actualizar
                                </button>
                            </div>
                        </div>
                        



                        <!-- ‚úÖ FILTROS ACTUALIZADOS -->
                        <div class="filters-section">
                            <div class="filter-group">
                                <label>Filtrar por tipo:</label>
                                <select id="filterType" onchange="applyFilters()">
                                    <option value="">Todos los tipos</option>
                                    <option value="hotel">Hoteles</option>
                                    <option value="cabana">Caba√±as</option>
                                    <option value="airbnb">Airbnb</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Filtrar por mes:</label>
                                <select id="filterMonth" onchange="applyFilters()">
                                    <option value="">Todos los meses</option>
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Filtrar por a√±o:</label>
                                <select id="filterYear" onchange="applyFilters()">
                                    <option value="">Todos los a√±os</option>
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <button class="btn btn-secondary" onclick="clearFilters()">
                                    <i class="fas fa-times"></i>
                                    Limpiar Filtros
                                </button>
                            </div>
                        </div>
                        

                        <!-- ‚úÖ ESTAD√çSTICAS EN TIEMPO REAL -->
                        <div class="reports-summary" id="reportsSummary" style="display: none;">
                            <div class="summary-cards">
                                <div class="summary-card">
                                    <div class="summary-icon">
                                        <i class="fas fa-file-alt"></i>
                                    </div>
                                    <div class="summary-content">
                                        <h3 id="totalReports">0</h3>
                                        <p>Total Reportes</p>
                                    </div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-icon">
                                        <i class="fas fa-hotel"></i>
                                    </div>
                                    <div class="summary-content">
                                        <h3 id="hotelReports">0</h3>
                                        <p>Hoteles</p>
                                    </div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-icon">
                                        <i class="fas fa-tree"></i>
                                    </div>
                                    <div class="summary-content">
                                        <h3 id="cabanaReports">0</h3>
                                        <p>Caba√±as</p>
                                    </div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-icon">
                                        <i class="fas fa-home"></i>
                                    </div>
                                    <div class="summary-content">
                                        <h3 id="airbnbReports">0</h3>
                                        <p>Airbnb</p>
                                    </div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="summary-content">
                                        <h3 id="totalTourists">0</h3>
                                        <p>Total Turistas</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        





                        <!-- Loading State -->
                        <div id="reportsLoading" class="loading" style="display: none;">
                            <i class="fas fa-spinner"></i>
                            <p>Cargando reportes...</p>
                        </div>
                        
                        <!-- ‚úÖ TABLA REDISE√ëADA CON MEJOR ESTRUCTURA -->
                        <div id="reportsTable" class="reports-table-container" style="display: none;">
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="establishment-column">
                                                <i class="fas fa-building"></i> Establecimiento
                                            </th>
                                            <th class="type-column">
                                                <i class="fas fa-tag"></i> Tipo
                                            </th>
                                            <th class="period-column">
                                                <i class="fas fa-calendar"></i> Per√≠odo
                                            </th>
                                            <th class="stats-column">
                                                <i class="fas fa-chart-bar"></i> Ocupaci√≥n*
                                            </th>
                                            <th class="stats-column">
                                                <i class="fas fa-flag"></i> Nac.*
                                            </th>
                                            <th class="stats-column">
                                                <i class="fas fa-globe"></i> Ext.*
                                            </th>
                                            <th class="stats-column">
                                                <i class="fas fa-users"></i> Total
                                            </th>
                                            <th class="stats-column">
                                                <i class="fas fa-user-friends"></i> P.Nac
                                            </th>
                                            <th class="stats-column">
                                                <i class="fas fa-user-friends"></i> P.Ext
                                            </th>
                                            <th class="stats-column">
                                                <i class="fas fa-bed"></i> Pernoc.
                                            </th>
                                            <th class="procedencia-column">
                                                <i class="fas fa-map-marker-alt"></i> Procedencia
                                            </th>
                                            <th class="actions-column">
                                                <i class="fas fa-cogs"></i> Acciones
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportsTableBody">
                                        <!-- Los datos se cargar√°n aqu√≠ -->
                                    </tbody>
                                </table>
                            </div>
                            <!-- ‚úÖ NOTA EXPLICATIVA MEJORADA -->
                            <div style="margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%); border-radius: 8px; font-size: 0.9em; color: #1976d2; border-left: 4px solid #2196f3;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Informaci√≥n:</strong>
                                </div>
                                <span style="color: #1976d2;">*</span> <strong>Para hoteles:</strong> Habitaciones ocupadas | 
                                <strong>Para Airbnb:</strong> D√≠as de ocupaci√≥n | 
                                <strong>Para Caba√±as:</strong> D√≠as ocupados
                            </div>
                        </div>
                        
                        <!-- ‚úÖ EMPTY STATE MEJORADO -->
                        <div id="reportsEmpty" class="empty-state" style="display: none;">
                            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 3rem; text-align: center; border: 2px dashed #dee2e6;">
                                <div style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%); width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                                    <i class="fas fa-inbox" style="font-size: 2rem; color: white;"></i>
                                </div>
                                <h3 style="color: #495057; margin-bottom: 0.5rem; font-size: 1.5rem;">No hay reportes disponibles</h3>
                                <p style="color: #6c757d; margin-bottom: 1.5rem;">Los establecimientos a√∫n no han enviado reportes semanales</p>
                                <button class="btn btn-primary" onclick="loadReports()" style="margin-top: 1rem;">
                                    <i class="fas fa-sync"></i>
                                    Actualizar Reportes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Data Sections -->
            <div id="data-section" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title" id="dataTitle">
                        <i class="fas fa-database"></i>
                        Datos del Sistema
                    </h2>
                </div>
                <div class="section-content">
                    <div class="loading" id="dataLoading">
                        <i class="fas fa-spinner"></i>
                        <p>Cargando datos...</p>
                    </div>
                    <div id="dataContent"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Acci√≥n completada</span>
    </div>
    
   <script>
        // Configuraci√≥n
        const baseURL = 'http://localhost:5000/api';
        const API_BASE_URL = baseURL; // Para compatibilidad con las funciones Excel
        const authToken = localStorage.getItem('authToken');
        const userData = JSON.parse(localStorage.getItem('userData') || '{}');
        
        // Verificar acceso de super admin
        if (!userData.email || (userData.email !== 'direcciondeturismojalpan@gmail.com' && !userData.isSuperAdmin)) {
            alert('Acceso denegado. Solo para Super Administradores.');
            window.location.href = 'dashboard.html';
        }
        
        // ‚úÖ VARIABLES GLOBALES ACTUALIZADAS
        let allData = {
            hoteles: [],
            cabanas: [],
            airbnb: [],
            tours: [],
            guias: [],
            reportes: []
        };
        let currentReports = [];
        let filteredReports = [];
        let currentSection = 'dashboard';
        
        // ==================== VARIABLES GLOBALES PARA ESTAD√çSTICAS ====================
        let statisticsCharts = {};
        let statisticsData = [];
        
        // Funciones auxiliares para las funciones Excel
        function getToken() {
            return authToken;
        }
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            loadAllData();
            
            // ‚úÖ INICIALIZAR FUNCIONES DE EXCEL
            loadXLSXLibrary().then(() => {
                console.log('‚úÖ Librer√≠a XLSX cargada correctamente');
            }).catch(error => {
                console.error('‚ùå Error al cargar XLSX:', error);
                showNotification('Error al cargar las funciones de Excel. Algunas descargas pueden no funcionar.', 'warning');
            });

            // ==================== CONFIGURACI√ìN INICIAL ESTAD√çSTICAS ====================
            console.log('üìä Configurando eventos de estad√≠sticas...');
            
            // Event listener para mostrar/ocultar fechas personalizadas
            const periodoSelect = document.getElementById('stats-periodo');
            if (periodoSelect) {
                periodoSelect.addEventListener('change', function() {
                    const customDates = document.getElementById('custom-dates');
                    if (customDates) {
                        customDates.style.display = this.value === 'personalizado' ? 'block' : 'none';
                    }
                });
            }
            
            // Event listeners para filtros con debounce
            const filterElements = ['stats-tipo-establecimiento', 'stats-periodo'];
            filterElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.addEventListener('change', function() {
                        clearTimeout(window.statisticsDebounceTimer);
                        window.statisticsDebounceTimer = setTimeout(() => {
                            if (statisticsData.length > 0) {
                                generateAdvancedStatistics();
                            }
                        }, 500);
                    });
                }
            });
            
            // Configurar fechas por defecto
            const today = new Date();
            const threeMonthsAgo = new Date(today);
            threeMonthsAgo.setMonth(today.getMonth() - 3);
            
            const fechaInicio = document.getElementById('stats-fecha-inicio');
            const fechaFin = document.getElementById('stats-fecha-fin');
            
            if (fechaInicio) fechaInicio.value = threeMonthsAgo.toISOString().split('T')[0];
            if (fechaFin) fechaFin.value = today.toISOString().split('T')[0];
            
            console.log('‚úÖ Eventos de estad√≠sticas configurados');
        });
        
        function initializePage() {
            // Mobile menu functionality
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            mobileMenuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            });
            overlay.addEventListener('click', function() {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            });
            // Update user info
            document.getElementById('userName').textContent = userData.nombre || 'Super Administrador';
            
            // Set user avatar initials
            const initials = userData.nombre ?
                userData.nombre.split(' ').map(n => n[0]).join('').toUpperCase() :
                'SA';
            document.getElementById('userInitials').textContent = initials;
        }
        
        //  endpoint del super admin para cargar TODOS los datos
        async function loadAllData() {
            try {
                console.log('Cargando TODOS los datos como Super Admin...');
                
                // ENDPOINT ESPECIAL DEL SUPER ADMIN
                const response = await fetch(`${baseURL}/super-admin/todos-los-datos`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Guarda TODOS los datos (activos e inactivos)
                    allData.hoteles = data.data?.hoteles || [];
                    allData.cabanas = data.data?.cabanas || [];
                    allData.airbnb = data.data?.airbnb || [];
                    allData.tours = data.data?.tours || [];
                    allData.guias = data.data?.guias || [];
                    
                    console.log(' Datos cargados exitosamente:');
                    console.log('- Hoteles:', allData.hoteles.length);
                    console.log('- Caba√±as:', allData.cabanas.length);
                    console.log('- Airbnb:', allData.airbnb.length);
                    console.log('- Tours:', allData.tours.length);
                    console.log('- Gu√≠as:', allData.guias.length);
                    
                    updateStats();
                } else {
                    throw new Error(data.message || 'Error en la respuesta del servidor');
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('Error cargando datos del sistema: ' + error.message, 'error');
            }
        }
        
        function updateStats() {
            document.getElementById('totalHoteles').textContent = allData.hoteles.length;
            document.getElementById('totalCabanas').textContent = allData.cabanas.length;
            document.getElementById('totalAirbnb').textContent = allData.airbnb.length;
            document.getElementById('totalTours').textContent = allData.tours.length;
            document.getElementById('totalGuias').textContent = allData.guias.length;
        }

        // ==================== FUNCIONES DE REPORTES EXCEL ====================     
        // Funci√≥n para cargar la librer√≠a XLSX si no est√° disponible
        function loadXLSXLibrary() {
            return new Promise((resolve, reject) => {
                if (typeof XLSX !== 'undefined') {
                    resolve(XLSX);
                    return;
                }          
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
                script.onload = () => {
                    if (typeof XLSX !== 'undefined') {
                        resolve(XLSX);
                    } else {
                        reject(new Error('Error al cargar la librer√≠a XLSX'));
                    }
                };
                script.onerror = () => reject(new Error('Error al descargar la librer√≠a XLSX'));
                document.head.appendChild(script);
            });
        }
        // ==================== FUNCI√ìN PRINCIPAL: DESCARGAR REPORTE INDIVIDUAL DE HOSPEDAJES ====================
        async function downloadHospedajesIndividualExcel() {
            try {
                showNotification('Preparando reporte individual de hospedajes...', 'info');             
                // Cargar todos los datos de hospedajes
                const response = await fetch(`${API_BASE_URL}/super-admin/todos-los-datos`, {
                    headers: {
                        'Authorization': `Bearer ${getToken()}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Error al cargar datos de hospedajes');
                }

                const data = await response.json();
                const { hoteles, cabanas, airbnb } = data.data;

                // Combinar todos los hospedajes
                const todosLosHospedajes = [
                    ...hoteles.map(h => ({ ...h, tipo: 'Hotel' })),
                    ...cabanas.map(c => ({ ...c, tipo: 'Caba√±a' })),
                    ...airbnb.map(a => ({ ...a, tipo: 'Airbnb' }))
                ];

                if (todosLosHospedajes.length === 0) {
                    showNotification('No hay hospedajes registrados', 'warning');
                    return;
                }

                // Crear el libro Excel
                const workbook = XLSX.utils.book_new();

                // Formatear datos para Excel
                const hospedajesData = todosLosHospedajes.map(hospedaje => {
                    // Formatear servicios
                    const servicios = hospedaje.servicios && Array.isArray(hospedaje.servicios) 
                        ? hospedaje.servicios.join(', ') 
                        : 'No especificados';

                    // Formatear m√©todos de pago
                    const metodosPago = hospedaje.metodosPago && Array.isArray(hospedaje.metodosPago)
                        ? hospedaje.metodosPago.map(m => {
                            const metodos = { 'efectivo': 'Efectivo', 'transferencia': 'Transferencia', 'tarjeta': 'Tarjeta' };
                            return metodos[m] || m;
                          }).join(', ')
                        : 'No especificados';

                    // Calcular habitaciones seg√∫n tipo
                    let habitaciones = 'No especificado';
                    if (hospedaje.tipo === 'Hotel' && hospedaje.capacidad?.habitaciones) {
                        habitaciones = hospedaje.capacidad.habitaciones;
                    } else if (hospedaje.tipo === 'Caba√±a' && hospedaje.caracteristicas?.habitaciones) {
                        habitaciones = hospedaje.caracteristicas.habitaciones;
                    } else if (hospedaje.tipo === 'Airbnb' && hospedaje.capacidad?.habitaciones) {
                        habitaciones = hospedaje.capacidad.habitaciones;
                    }

                    // Precio seg√∫n tipo
                    const precio = hospedaje.precio 
                        ? `${hospedaje.precio.toLocaleString('es-MX')} MXN`
                        : hospedaje.precioPorNoche 
                        ? `${hospedaje.precioPorNoche.toLocaleString('es-MX')} MXN/noche`
                        : 'No especificado';

                    return {
                        'Nombre': hospedaje.nombre || 'No especificado',
                        'Tipo': hospedaje.tipo,
                        'Ubicaci√≥n - Direcci√≥n': hospedaje.ubicacion?.direccion || 'No especificada',
                        'Ubicaci√≥n - Ciudad': hospedaje.ubicacion?.ciudad || 'No especificada',
                        'Ubicaci√≥n - Estado': hospedaje.ubicacion?.estado || 'Quer√©taro',
                        'C√≥digo Postal': hospedaje.ubicacion?.codigoPostal || 'No especificado',
                        'Precio': precio,
                        'Habitaciones': habitaciones,
                        'Tel√©fono': hospedaje.contacto?.telefono || 'No especificado',
                        'Correo': hospedaje.contacto?.email || 'No especificado',
                        'Horario': hospedaje.contacto?.horario || 'No especificado',
                        'Sitio Web': hospedaje.contacto?.sitioWeb || 'No especificado',
                        'Servicios': servicios,
                        'M√©todos de Pago': metodosPago,
                        'Propietario': hospedaje.propietario?.nombre || 'No especificado',
                        'Email Propietario': hospedaje.propietario?.email || 'No especificado'
                    };
                });

                // Crear hoja de trabajo
                const worksheet = XLSX.utils.json_to_sheet(hospedajesData);

                // Configurar anchos de columna
                worksheet['!cols'] = [
                    { wch: 25 }, // Nombre
                    { wch: 10 }, // Tipo
                    { wch: 30 }, // Direcci√≥n
                    { wch: 15 }, // Ciudad
                    { wch: 12 }, // Estado
                    { wch: 12 }, // C√≥digo Postal
                    { wch: 18 }, // Precio
                    { wch: 12 }, // Habitaciones
                    { wch: 15 }, // Tel√©fono
                    { wch: 25 }, // Correo
                    { wch: 20 }, // Horario
                    { wch: 25 }, // Sitio Web
                    { wch: 40 }, // Servicios
                    { wch: 25 }, // M√©todos de Pago
                    { wch: 20 }, // Propietario
                    { wch: 25 }  // Email Propietario
                ];

                XLSX.utils.book_append_sheet(workbook, worksheet, 'Hospedajes Individual');

                // Generar archivo
                const fecha = new Date().toLocaleDateString('es-ES').replace(/\//g, '-');
                const filename = `Reporte_Individual_Hospedajes_${fecha}.xlsx`;
                
                XLSX.writeFile(workbook, filename);
                showNotification(`Reporte individual descargado: ${todosLosHospedajes.length} hospedajes`, 'success');

            } catch (error) {
                console.error('Error al generar reporte individual:', error);
                showNotification('Error al generar reporte individual: ' + error.message, 'error');
            }
        }

        // ==================== FUNCI√ìN PRINCIPAL: DESCARGAR REPORTE TOTAL CONSOLIDADO ====================
        async function downloadHospedajesTotalExcel() {
            try {
                showNotification('Preparando reporte total consolidado...', 'info');
                
                // Cargar datos de hospedajes
                const hospedajesResponse = await fetch(`${API_BASE_URL}/super-admin/todos-los-datos`, {
                    headers: { 'Authorization': `Bearer ${getToken()}` }
                });

                if (!hospedajesResponse.ok) {
                    throw new Error('Error al cargar datos de hospedajes');
                }

                const hospedajesData = await hospedajesResponse.json();
                const { hoteles, cabanas, airbnb } = hospedajesData.data;

                // Calcular totales
                let totalCapacidadPersonas = 0;
                let totalHabitaciones = 0;

                // Procesar hoteles
                let capacidadHoteles = 0;
                let habitacionesHoteles = 0;
                hoteles.forEach(hotel => {
                    capacidadHoteles += hotel.capacidad?.personasMax || 0;
                    habitacionesHoteles += hotel.capacidad?.habitaciones || 0;
                });

                // Procesar caba√±as
                let capacidadCabanas = 0;
                let habitacionesCabanas = 0;
                cabanas.forEach(cabana => {
                    capacidadCabanas += cabana.capacidad?.huespedes || 0;
                    habitacionesCabanas += cabana.caracteristicas?.habitaciones || 1;
                });

                // Procesar airbnb
                let capacidadAirbnb = 0;
                let habitacionesAirbnb = 0;
                airbnb.forEach(airbnbItem => {
                    capacidadAirbnb += airbnbItem.capacidad?.huespedes || 0;
                    habitacionesAirbnb += airbnbItem.capacidad?.habitaciones || 1;
                });

                // Totales generales
                totalCapacidadPersonas = capacidadHoteles + capacidadCabanas + capacidadAirbnb;
                totalHabitaciones = habitacionesHoteles + habitacionesCabanas + habitacionesAirbnb;

                // Crear datos para el reporte
                const reporteTotal = [
                    { 'Concepto': '=== RESUMEN GENERAL ===', 'Cantidad': '' },
                    { 'Concepto': 'Total de Hospedajes', 'Cantidad': hoteles.length + cabanas.length + airbnb.length },
                    { 'Concepto': 'Total Hoteles', 'Cantidad': hoteles.length },
                    { 'Concepto': 'Total Caba√±as', 'Cantidad': cabanas.length },
                    { 'Concepto': 'Total Airbnb', 'Cantidad': airbnb.length },
                    { 'Concepto': '', 'Cantidad': '' },
                    { 'Concepto': '=== CAPACIDADES TOTALES ===', 'Cantidad': '' },
                    { 'Concepto': 'üéØ CAPACIDAD M√ÅXIMA DE PERSONAS', 'Cantidad': totalCapacidadPersonas },
                    { 'Concepto': 'üè® TOTAL DE HABITACIONES', 'Cantidad': totalHabitaciones },
                    { 'Concepto': '', 'Cantidad': '' },
                    { 'Concepto': '=== DESGLOSE POR TIPO ===', 'Cantidad': '' },
                    { 'Concepto': 'Hoteles - Capacidad Personas', 'Cantidad': capacidadHoteles },
                    { 'Concepto': 'Hoteles - Habitaciones', 'Cantidad': habitacionesHoteles },
                    { 'Concepto': 'Caba√±as - Capacidad Personas', 'Cantidad': capacidadCabanas },
                    { 'Concepto': 'Caba√±as - Habitaciones', 'Cantidad': habitacionesCabanas },
                    { 'Concepto': 'Airbnb - Capacidad Personas', 'Cantidad': capacidadAirbnb },
                    { 'Concepto': 'Airbnb - Habitaciones', 'Cantidad': habitacionesAirbnb }
                ];

                // Crear libro Excel
                const workbook = XLSX.utils.book_new();

                // Hoja 1: Reporte Total
                const worksheetTotal = XLSX.utils.json_to_sheet(reporteTotal);
                worksheetTotal['!cols'] = [{ wch: 35 }, { wch: 15 }];
                XLSX.utils.book_append_sheet(workbook, worksheetTotal, 'Reporte Total');

                // Hoja 2: Detalle por Tipo
                const detalleData = [
                    { 'Tipo': 'Hotel', 'Cantidad': hoteles.length, 'Capacidad Personas': capacidadHoteles, 'Habitaciones': habitacionesHoteles },
                    { 'Tipo': 'Caba√±a', 'Cantidad': cabanas.length, 'Capacidad Personas': capacidadCabanas, 'Habitaciones': habitacionesCabanas },
                    { 'Tipo': 'Airbnb', 'Cantidad': airbnb.length, 'Capacidad Personas': capacidadAirbnb, 'Habitaciones': habitacionesAirbnb },
                    { 'Tipo': 'TOTAL', 'Cantidad': hoteles.length + cabanas.length + airbnb.length, 'Capacidad Personas': totalCapacidadPersonas, 'Habitaciones': totalHabitaciones }
                ];

                const worksheetDetalle = XLSX.utils.json_to_sheet(detalleData);
                worksheetDetalle['!cols'] = [{ wch: 15 }, { wch: 12 }, { wch: 18 }, { wch: 15 }];
                XLSX.utils.book_append_sheet(workbook, worksheetDetalle, 'Detalle por Tipo');

                // Intentar cargar reportes semanales (opcional)
                try {
                    const reportesResponse = await fetch(`${API_BASE_URL}/cuestionarios/reportes-super-admin`, {
                        headers: { 'Authorization': `Bearer ${getToken()}` }
                    });

                    if (reportesResponse.ok) {
                        const reportesData = await reportesResponse.json();
                        const reportes = reportesData.data?.cuestionarios || [];

                        if (reportes.length > 0) {
                            let totalPersonasReportadas = 0;
                            let totalPernoctaciones = 0;

                            reportes.forEach(reporte => {
                                totalPersonasReportadas += reporte.datos?.totalPersonas || 0;
                                totalPernoctaciones += reporte.datos?.totalPernoctaciones || 0;
                            });

                            // Hoja 3: Estad√≠sticas de Reportes
                            const reportesStats = [
                                { 'Concepto': '=== REPORTES SEMANALES ===', 'Cantidad': '' },
                                { 'Concepto': 'Total Reportes Registrados', 'Cantidad': reportes.length },
                                { 'Concepto': 'Total Personas Reportadas', 'Cantidad': totalPersonasReportadas },
                                { 'Concepto': 'Total Pernoctaciones', 'Cantidad': totalPernoctaciones },
                                { 'Concepto': '', 'Cantidad': '' },
                                { 'Concepto': '=== AN√ÅLISIS ===', 'Cantidad': '' },
                                { 'Concepto': 'Promedio Personas por Reporte', 'Cantidad': reportes.length > 0 ? Math.round(totalPersonasReportadas / reportes.length) : 0 },
                                { 'Concepto': '% Ocupaci√≥n Estimada', 'Cantidad': totalCapacidadPersonas > 0 ? `${Math.round((totalPersonasReportadas / totalCapacidadPersonas) * 100)}%` : '0%' }
                            ];

                            const worksheetReportes = XLSX.utils.json_to_sheet(reportesStats);
                            worksheetReportes['!cols'] = [{ wch: 30 }, { wch: 20 }];
                            XLSX.utils.book_append_sheet(workbook, worksheetReportes, 'Estad√≠sticas Reportes');
                        }
                    }
                } catch (reportesError) {
                    console.log('No se pudieron cargar estad√≠sticas de reportes:', reportesError.message);
                }

                // Generar archivo
                const fecha = new Date().toLocaleDateString('es-ES').replace(/\//g, '-');
                const filename = `Reporte_Total_Consolidado_${fecha}.xlsx`;
                
                XLSX.writeFile(workbook, filename);
                showNotification(`Reporte total generado - Capacidad: ${totalCapacidadPersonas} personas, Habitaciones: ${totalHabitaciones}`, 'success');

            } catch (error) {
                console.error('Error al generar reporte total:', error);
                showNotification('Error al generar reporte total: ' + error.message, 'error');
            }
        }

        // ==================== FUNCI√ìN COMBINADA: DESCARGAR AMBOS REPORTES ====================
        async function downloadHospedajesCompletoExcel() {
            try {
                showNotification('Generando reportes completos de hospedajes...', 'info');
                
                // Generar reporte individual
                await downloadHospedajesIndividualExcel();
                
                // Esperar un poco antes del segundo reporte
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Generar reporte total
                await downloadHospedajesTotalExcel();
                
                showNotification('¬°Ambos reportes de hospedajes generados exitosamente!', 'success');
                
            } catch (error) {
                console.error('Error al generar reportes completos:', error);
                showNotification('Error al generar reportes completos', 'error');
            }
        }

        // FUNCIONES JAVASCRIPT PARA EL MODAL
        const formConfigs = {
            hotel: {
                title: 'Crear Nuevo Hotel',
                fields: [
                    { name: 'nombre', label: 'Nombre del Hotel', type: 'text', required: true },
                    { name: 'propietario_nombre', label: 'Nombre del Propietario', type: 'text', required: true },
                    { name: 'contacto.email', label: 'Email del Propietario (para acceso)', type: 'email', required: true },
                    { name: 'contacto.telefono', label: 'Tel√©fono', type: 'tel', required: true },
                    { name: 'ubicacion.direccion', label: 'Direcci√≥n', type: 'text', required: true },
                    { name: 'ubicacion.ciudad', label: 'Ciudad', type: 'text', required: true },
                    { name: 'capacidad.habitaciones', label: 'Total de Habitaciones', type: 'number', required: true },
                    { name: 'capacidad.personasMax', label: 'Capacidad M√°xima', type: 'number', required: true },
                    { name: 'precio', label: 'Precio por Noche', type: 'number', required: true },
                    { name: 'descripcion', label: 'Descripci√≥n', type: 'textarea', required: true }
                ],
                endpoint: '/super-admin/crear-hotel-con-usuario'
            },
            cabana: {
                title: 'Crear Nueva Caba√±a',
                fields: [
                    { name: 'nombre', label: 'Nombre de la Caba√±a', type: 'text', required: true },
                    { name: 'propietario_nombre', label: 'Nombre del Propietario', type: 'text', required: true },
                    { name: 'contacto.email', label: 'Email del Propietario (para acceso)', type: 'email', required: true },
                    { name: 'contacto.telefono', label: 'Tel√©fono', type: 'tel', required: true },
                    { name: 'ubicacion.direccion', label: 'Direcci√≥n', type: 'text', required: true },
                    { name: 'ubicacion.ciudad', label: 'Ciudad', type: 'text', required: true },
                    { name: 'capacidad.huespedes', label: 'Capacidad de Hu√©spedes', type: 'number', required: true },
                    { name: 'capacidad.habitaciones', label: 'N√∫mero de Habitaciones', type: 'number', required: true },
                    { name: 'precio', label: 'Precio por Noche', type: 'number', required: true },
                    { name: 'descripcion', label: 'Descripci√≥n', type: 'textarea', required: true }
                ],
                endpoint: '/super-admin/crear-cabana-con-usuario'
            },
            airbnb: {
                title: 'Crear Nuevo Alojamiento',
                fields: [
                    { name: 'nombre', label: 'Nombre del Alojamiento', type: 'text', required: true },
                    { name: 'propietario_nombre', label: 'Nombre del Propietario', type: 'text', required: true },
                    { name: 'contacto.email', label: 'Email del Propietario (para acceso)', type: 'email', required: true },
                    { name: 'contacto.telefono', label: 'Tel√©fono', type: 'tel', required: true },
                    { name: 'tipoPropiedad', label: 'Tipo de Propiedad', type: 'select', options: ['caba√±a', 'casa', 'zona_camping'], required: true },
                    { name: 'ubicacion.direccion', label: 'Direcci√≥n', type: 'text', required: true },
                    { name: 'ubicacion.ciudad', label: 'Ciudad', type: 'text', required: true },
                    { name: 'capacidad.huespedes', label: 'Capacidad de Hu√©spedes', type: 'number', required: true },
                    { name: 'precioPorNoche', label: 'Precio por Noche', type: 'number', required: true },
                    { name: 'descripcion', label: 'Descripci√≥n', type: 'textarea', required: true }
                ],
                endpoint: '/super-admin/crear-airbnb-con-usuario'
            },
           guiaturistica: {
            title: 'Crear Nueva Gu√≠a Tur√≠stica',
            fields: [
                { name: 'nombre', label: 'Nombre', type: 'text', required: true },
                { name: 'apellidos', label: 'Apellidos', type: 'text', required: true },
                { name: 'contacto.email', label: 'Correo', type: 'email', required: true },
                { name: 'contacto.telefono', label: 'Tel√©fono', type: 'tel', required: true },
                { name: 'especialidades', label: 'Especialidades', type: 'select-multiple', 
                  options: ['excursionismo', 'misiones_franciscanas', 'interpretacion_ambiental', 'guia_cultural'], required: true }
            ],
            endpoint: '/super-admin/crear-guia-con-usuario'
            },
            // ‚úÖ CONFIGURACI√ìN MODIFICADA: Redes Sociales en lugar de Servicios
            touroperadora: {
                title: 'Crear Nueva Tour Operadora',
                fields: [
                    { name: 'nombre', label: 'Nombre de la Operadora', type: 'text', required: true },
                    { name: 'propietario_nombre', label: 'Nombre del Propietario', type: 'text', required: true },
                    { name: 'contacto.email', label: 'Email del Propietario (para acceso)', type: 'email', required: true },
                    { name: 'contacto.telefono', label: 'Tel√©fono', type: 'tel', required: true },
                    { name: 'ubicacion.direccion', label: 'Direcci√≥n', type: 'text', required: true },
                    { name: 'ubicacion.ciudad', label: 'Ciudad', type: 'text', required: true },
                    
                    // üÜï APARTADO DE REDES SOCIALES (reemplaza servicios)
                    { name: 'contacto.redesSociales.facebook', label: 'Facebook', type: 'url', required: false, placeholder: 'https://facebook.com/tu-pagina' },
                    { name: 'contacto.redesSociales.instagram', label: 'Instagram', type: 'url', required: false, placeholder: 'https://instagram.com/tu-cuenta' },
                    { name: 'contacto.redesSociales.twitter', label: 'Twitter/X', type: 'url', required: false, placeholder: 'https://twitter.com/tu-cuenta' },
                    { name: 'contacto.whatsapp', label: 'WhatsApp Business', type: 'tel', required: false, placeholder: '+52 xxx xxx xxxx' },
                    { name: 'contacto.sitioWeb', label: 'Sitio Web', type: 'url', required: false, placeholder: 'https://tu-sitio-web.com' },
                    
                    { name: 'descripcion', label: 'Descripci√≥n', type: 'textarea', required: true }
                ],
                endpoint: '/super-admin/crear-tour-con-usuario'
            }
        };

        function openCreateModal(type) {
            const modal = document.getElementById('createModal');
            const modalTitle = document.getElementById('modalTitle');
            const dynamicContent = document.getElementById('dynamicFormContent');
            const form = document.getElementById('createForm');
            
            const config = formConfigs[type];
            if (!config) {
                showNotification('Tipo de establecimiento no v√°lido', 'error');
                return;
            }
            
            // Actualizar t√≠tulo
            modalTitle.textContent = config.title;
            
            // Generar campos del formulario
            let fieldsHTML = '';
            config.fields.forEach(field => {
                if (field.type === 'select') {
                    fieldsHTML += `
                        <div class="form-group">
                            <label for="${field.name}">${field.label} ${field.required ? '*' : ''}</label>
                            <select id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''}>
                                <option value="">Seleccionar...</option>
                                ${field.options.map(option => `<option value="${option}">${option.charAt(0).toUpperCase() + option.slice(1).replace('_', ' ')}</option>`).join('')}
                            </select>
                        </div>
                    `;
                } else if (field.type === 'select-multiple') {
                    fieldsHTML += `
                        <div class="form-group">
                            <label for="${field.name}">${field.label} ${field.required ? '*' : ''}</label>
                            <select id="${field.name}" name="${field.name}" multiple ${field.required ? 'required' : ''} style="height: 120px;">
                                ${field.options.map(option => `<option value="${option}">${option.charAt(0).toUpperCase() + option.slice(1).replace('_', ' ')}</option>`).join('')}
                            </select>
                            <small class="form-hint">Mant√©n Ctrl presionado para seleccionar m√∫ltiples opciones</small>
                        </div>
                    `;
                } else if (field.type === 'textarea') {
                    fieldsHTML += `
                        <div class="form-group">
                            <label for="${field.name}">${field.label} ${field.required ? '*' : ''}</label>
                            <textarea id="${field.name}" name="${field.name}" rows="4" ${field.required ? 'required' : ''}></textarea>
                        </div>
                    `;
                } else {
                    // ‚úÖ SOPORTE PARA PLACEHOLDER EN CAMPOS DE URL Y TEL
                    const placeholderAttr = field.placeholder ? `placeholder="${field.placeholder}"` : '';
                    fieldsHTML += `
                        <div class="form-group">
                            <label for="${field.name}">${field.label} ${field.required ? '*' : ''}</label>
                            <input type="${field.type}" id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''} ${placeholderAttr}>
                        </div>
                    `;
                }
            });
            
            dynamicContent.innerHTML = fieldsHTML;
            
            // Configurar el evento de env√≠o del formulario
            form.onsubmit = (e) => submitCreateForm(e, type, config.endpoint);
            
            // Mostrar modal
            modal.style.display = 'block';
        }

        function closeCreateModal() {
            const modal = document.getElementById('createModal');
            modal.style.display = 'none';
            
            // Limpiar formulario
            document.getElementById('createForm').reset();
        }

        async function submitCreateForm(event, type, endpoint) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // Convertir FormData a objeto
            const data = {};
            formData.forEach((value, key) => {
                // Manejar campos anidados (ej: ubicacion.ciudad)
                if (key.includes('.')) {
                    const keys = key.split('.');
                    if (keys.length === 2) {
                        if (!data[keys[0]]) data[keys[0]] = {};
                        data[keys[0]][keys[1]] = value;
                    } else if (keys.length === 3) {
                        if (!data[keys[0]]) data[keys[0]] = {};
                        if (!data[keys[0]][keys[1]]) data[keys[0]][keys[1]] = {};
                        data[keys[0]][keys[1]][keys[2]] = value;
                    }
                } else {
                    data[key] = value;
                }
            });
            
            // Manejar campos select-multiple
            const multiSelects = form.querySelectorAll('select[multiple]');
            multiSelects.forEach(select => {
                const selectedValues = Array.from(select.selectedOptions).map(option => option.value);
                const fieldName = select.name;
                
                if (fieldName.includes('.')) {
                    const keys = fieldName.split('.');
                    if (!data[keys[0]]) data[keys[0]] = {};
                    data[keys[0]][keys[1]] = selectedValues;
                } else {
                    data[fieldName] = selectedValues;
                }
            });
            
            // üî• PROCESAMIENTO SIMPLIFICADO PARA GU√çAS - SIN ERRORES
            if (type === 'guiaturistica') {
                // ‚úÖ FORMULARIO SIMPLIFICADO - Solo validar que especialidades est√© presente
                if (!data.especialidades || data.especialidades.length === 0) {
                    showNotification('Debe seleccionar al menos una especialidad', 'error');
                    return;
                }
                // Ya no procesamos idiomas ni ubicaci√≥n - formulario simplificado
            }
            
            // ‚úÖ TOUR OPERADORA: Los campos de redes sociales ya est√°n procesados correctamente
            if (type === 'touroperadora') {
                // Los campos de redes sociales se procesan autom√°ticamente como campos anidados
                // contacto.redesSociales.facebook, contacto.whatsapp, etc.
                console.log('üì± Datos de tour operadora con redes sociales:', data);
            }
            
            try {
                const response = await fetch(`${baseURL}${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // üî• MOSTRAR INFORMACI√ìN COMPLETA DEL RESULTADO
                    const tipeName = formConfigs[type].title.replace('Crear ', '');
                    let successMessage = `${tipeName} creado exitosamente`;
                    
                    // Si se cre√≥ un usuario, mostrar informaci√≥n adicional
                    if (result.data.usuario && result.data.usuario.contrase√±aTemporal) {
                        successMessage += `\n\nüë§ Usuario creado:\nEmail: ${result.data.usuario.email}\nContrase√±a temporal: ${result.data.usuario.contrase√±aTemporal}\n\n‚ö†Ô∏è IMPORTANTE: Guarda esta contrase√±a y comp√°rtela con el propietario. No se volver√° a mostrar.`;
                    }
                    
                    // Mostrar notificaci√≥n con informaci√≥n detallada
                    showDetailedNotification(successMessage, 'success', result.data);
                    closeCreateModal();
                    
                    // Recargar las estad√≠sticas y datos
                    loadAllData(); // ‚úÖ NUEVO: Recargar todos los datos desde el servidor
                    
                    // Si estamos viendo la secci√≥n correspondiente, recargarla
                    const currentSection = document.querySelector('.data-content:not([style*="display: none"])');
                    if (currentSection) {
                        const sectionType = currentSection.closest('[id]').id.replace('Content', '').replace('Data', '');
                        if (sectionType.toLowerCase().includes(type) || 
                            (type === 'airbnb' && sectionType.toLowerCase().includes('alojamiento')) ||
                            (type === 'guiaturistica' && sectionType.toLowerCase().includes('guia')) ||
                            (type === 'touroperadora' && sectionType.toLowerCase().includes('tour'))) {
                            displayData(getDataTypeFromSection(sectionType));
                        }
                    }
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.message || `Error al crear ${type}`);
                }
                
            } catch (error) {
                console.error('Error creating:', error);
                showNotification(error.message || `Error al crear ${formConfigs[type].title.toLowerCase()}`, 'error');
            }
        }

        // Funci√≥n auxiliar para mapear secciones a tipos de datos
        function getDataTypeFromSection(section) {
            const mapping = {
                'hotels': 'hoteles',
                'cabanas': 'cabanas', 
                'alojamientos': 'alojamientos',
                'guias': 'guias',
                'tours': 'tours'
            };
            return mapping[section.toLowerCase()] || section;
        }

        // üî• NUEVA FUNCI√ìN: Mostrar notificaci√≥n detallada con informaci√≥n del usuario creado
        function showDetailedNotification(message, type, data) {
            // Si hay informaci√≥n de usuario creado, mostrar modal especial
            if (data && data.usuario && data.usuario.contrase√±aTemporal) {
                showUserCreatedModal(data);
            } else {
                // Usar notificaci√≥n normal
                if (typeof showNotification === 'function') {
                    showNotification(message, type);
                } else {
                    alert(message);
                }
            }
        }

        // üî• NUEVA FUNCI√ìN: Modal especial para mostrar informaci√≥n del usuario creado
        function showUserCreatedModal(data) {
            // Crear modal temporal
            const modalHTML = `
                <div id="userCreatedModal" class="modal" style="display: block;">
                    <div class="modal-content" style="max-width: 500px;">
                        <div class="modal-header" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
                            <h2><i class="fas fa-check-circle"></i> ¬°Establecimiento y Usuario Creados!</h2>
                        </div>
                        <div class="modal-body">
                            <div class="success-info">
                                <p><strong>‚úÖ ${data.establecimiento?.nombre || 'Establecimiento'}</strong> ha sido creado exitosamente.</p>
                                
                                <div class="user-credentials">
                                    <h4><i class="fas fa-user"></i> Credenciales del Usuario:</h4>
                                    <div class="credential-item">
                                        <label>Email:</label>
                                        <div class="credential-value">
                                            <span>${data.usuario.email}</span>
                                            <button onclick="copyToClipboard('${data.usuario.email}')" class="copy-btn" title="Copiar email">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="credential-item">
                                        <label>Contrase√±a temporal:</label>
                                        <div class="credential-value">
                                            <span class="password-value">${data.usuario.contrase√±aTemporal}</span>
                                            <button onclick="copyToClipboard('${data.usuario.contrase√±aTemporal}')" class="copy-btn" title="Copiar contrase√±a">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="important-note">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <div>
                                        <strong>¬°IMPORTANTE!</strong>
                                        <p>Guarda esta informaci√≥n y comp√°rtela con el propietario. La contrase√±a temporal no se volver√° a mostrar por seguridad.</p>
                                        <p>El propietario podr√° cambiar su contrase√±a una vez que inicie sesi√≥n.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="modal-actions" style="justify-content: center; margin-top: 2rem;">
                                <button onclick="closeUserCreatedModal()" class="btn-create" style="margin: 0;">
                                    <i class="fas fa-check"></i> Entendido
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Agregar al DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function closeUserCreatedModal() {
            const modal = document.getElementById('userCreatedModal');
            if (modal) {
                modal.remove();
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // Mostrar feedback visual
                const notification = document.createElement('div');
                notification.className = 'copy-notification';
                notification.textContent = '¬°Copiado!';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #48bb78;
                    color: white;
                    padding: 0.5rem 1rem;
                    border-radius: 5px;
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                `;
                
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 2000);
            });
        }

        // Cerrar modal al hacer click fuera de √©l
        window.onclick = function(event) {
            const modal = document.getElementById('createModal');
            if (event.target === modal) {
                closeCreateModal();
            }
        }
                
        // ‚úÖ FUNCI√ìN MODIFICADA PARA INCLUIR ESTAD√çSTICAS
        function showSection(section) {
            // Update active menu item
            document.querySelectorAll('.menu-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('.menu-link').classList.add('active');
            
            // Hide all sections
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById('reportes-section').style.display = 'none';
            document.getElementById('reportes-hoteles-section').style.display = 'none';
            document.getElementById('data-section').style.display = 'none';
            
            // ‚úÖ OCULTAR TAMBI√âN LA SECCI√ìN DE ESTAD√çSTICAS
            const estadisticasSection = document.getElementById('estadisticas-section');
            if (estadisticasSection) {
                estadisticasSection.style.display = 'none';
            }
            
            currentSection = section;
            
            if (section === 'dashboard') {
                document.getElementById('dashboard-section').style.display = 'block';
            } else if (section === 'reportes') {
                document.getElementById('reportes-section').style.display = 'block';
            } else if (section === 'reportes-hoteles') {
                document.getElementById('reportes-hoteles-section').style.display = 'block';
                loadReports(); // Auto cargar reportes
            } else if (section === 'estadisticas') {  // ‚úÖ AGREGAR CASO PARA ESTAD√çSTICAS
                if (estadisticasSection) {
                    estadisticasSection.style.display = 'block';
                    // Inicializar estad√≠sticas
                    setTimeout(() => {
                        if (statisticsData.length === 0) {
                            loadStatisticsData().then(data => {
                                statisticsData = data;
                                if (data.length > 0) {
                                    generateAdvancedStatistics();
                                }
                            }).catch(error => {
                                console.error('Error cargando datos de estad√≠sticas:', error);
                                showNotification('Error al cargar datos para estad√≠sticas', 'error');
                            });
                        } else {
                            generateAdvancedStatistics();
                        }
                    }, 100);
                }
            } else {
                showDataSection(section);
            }
            
            // Close mobile menu
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        function showDataSection(type) {
            const dataSection = document.getElementById('data-section');
            const dataTitle = document.getElementById('dataTitle');
            const dataLoading = document.getElementById('dataLoading');
            const dataContent = document.getElementById('dataContent');
            const titles = {
                hoteles: 'Todos los Hoteles del Sistema',
                cabanas: 'Todas las Caba√±as del Sistema',
                airbnb: 'Todos los Alojamientos Airbnb',
                tours: 'Todas las Tour Operadoras',
                guias: 'Todas las Gu√≠as Tur√≠sticas'
            };
            const icons = {
                hoteles: 'fa-hotel',
                cabanas: 'fa-tree',
                airbnb: 'fa-home',
                tours: 'fa-route',
                guias: 'fa-user-tie'
            };
            dataTitle.innerHTML = `<i class="fas ${icons[type]}"></i> ${titles[type]}`;
            dataSection.style.display = 'block';
            dataLoading.style.display = 'block';
            dataContent.innerHTML = '';
            // Simular carga y mostrar datos
            setTimeout(() => {
                dataLoading.style.display = 'none';
                displayData(type);
            }, 1000);
        }
        
        // üî• FUNCI√ìN MEJORADA: Display data con botones de toggle status Y eliminar
        function displayData(type) {
            const dataContent = document.getElementById('dataContent');
            const data = allData[type] || [];
            if (data.length === 0) {
                dataContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No hay datos disponibles</h3>
                        <p>No se encontraron ${type} en el sistema</p>
                    </div>
                `;
                return;
            }
            const dataContainer = document.createElement('div');
            dataContainer.className = 'data-container';
            data.forEach(item => {
                const dataItem = document.createElement('div');
                dataItem.className = 'data-item';
                let itemInfo = '';
                switch(type) {
                    case 'hoteles':
                        itemInfo = `
                            <div class="data-info">
                                <div class="data-name">${item.nombre}</div>
                                <div class="data-details">
                                    Propietario: ${item.propietario?.nombre || 'N/A'} | 
                                    Ciudad: ${item.ubicacion?.ciudad || 'N/A'} | 
                                    Precio: ${item.precio?.toLocaleString('es-MX') || 'N/A'}
                                </div>
                            </div>
                        `;
                        break;
                    case 'cabanas':
                        itemInfo = `
                            <div class="data-info">
                                <div class="data-name">${item.nombre}</div>
                                <div class="data-details">
                                    Propietario: ${item.propietario?.nombre || 'N/A'} | 
                                    Ciudad: ${item.ubicacion?.ciudad || 'N/A'} | 
                                    Hu√©spedes: ${item.capacidad?.huespedes || 'N/A'}
                                </div>
                            </div>
                        `;
                        break;
                    case 'airbnb':
                        itemInfo = `
                            <div class="data-info">
                                <div class="data-name">${item.nombre}</div>
                                <div class="data-details">
                                    Propietario: ${item.propietario?.nombre || 'N/A'} | 
                                    Tipo: ${item.tipoPropiedad || 'N/A'} | 
                                    Ciudad: ${item.ubicacion?.ciudad || 'N/A'}
                                </div>
                            </div>
                        `;
                        break;
                    case 'tours':
                        itemInfo = `
                            <div class="data-info">
                                <div class="data-name">${item.nombre}</div>
                                <div class="data-details">
                                    Propietario: ${item.propietario?.nombre || 'N/A'} | 
                                    Tours: ${item.tours?.length || 0} | 
                                    Ciudad: ${item.ubicacion?.ciudad || 'N/A'}
                                </div>
                            </div>
                        `;
                        break;
                    case 'guias':
                        itemInfo = `
                            <div class="data-info">
                                <div class="data-name">${item.nombre} ${item.apellidos || ''}</div>
                                <div class="data-details">
                                    Propietario: ${item.propietario?.nombre || 'N/A'} | 
                                    Especialidades: ${item.especialidades?.join(', ') || 'N/A'}
                                </div>
                            </div>
                        `;
                        break;
                }
                const statusClass = item.activo ? 'status-active' : 'status-inactive';
                const statusText = item.activo ? 'ACTIVO' : 'INACTIVO';
                
                // botones de toggle status Y eliminar
                const toggleButton = item.activo 
                    ? `<button class="btn-toggle block" onclick="toggleStatus('${type}', '${item._id}', true)" title="Bloquear establecimiento">
                        <i class="fas fa-ban"></i> Bloquear
                       </button>`
                    : `<button class="btn-toggle activate" onclick="toggleStatus('${type}', '${item._id}', false)" title="Activar establecimiento">
                        <i class="fas fa-check"></i> Activar
                       </button>`;

                // Bot√≥n de eliminar
                const deleteButton = `<button class="btn-delete" onclick="deleteItem('${type}', '${item._id}')" title="Eliminar establecimiento">
                    <i class="fas fa-trash"></i> Eliminar
                </button>`;
                
                dataItem.innerHTML = itemInfo + `
                    <div class="data-actions">
                        <div class="data-status ${statusClass}">
                            ${statusText}
                        </div>
                        <div class="action-buttons">
                            ${toggleButton}
                            ${deleteButton}
                        </div>
                    </div>
                `;
                dataContainer.appendChild(dataItem);
            });
            dataContent.appendChild(dataContainer);
        }
        
        // Toggle status para bloquear/activar establecimientos
        async function toggleStatus(type, itemId, currentStatus) {
            // Mostrar confirmaci√≥n
            const action = currentStatus ? 'bloquear' : 'activar';
            const typeNames = {
                hoteles: 'hotel',
                cabanas: 'caba√±a',
                airbnb: 'alojamiento',
                tours: 'tour operadora',
                guias: 'gu√≠a tur√≠stica'
            };
            
            const typeName = typeNames[type];
            
            if (!confirm(`¬øEst√° seguro que desea ${action} este ${typeName}?`)) {
                return;
            }

            try {
                //  rutas correctas del super-admin con toggle-status
                let endpoint;
                switch(type) {
                    case 'hoteles':
                        endpoint = `/super-admin/hoteles/${itemId}/toggle-status`;
                        break;
                    case 'cabanas':
                        endpoint = `/super-admin/cabanas/${itemId}/toggle-status`;
                        break;
                    case 'airbnb':
                        endpoint = `/super-admin/airbnb/${itemId}/toggle-status`;
                        break;
                    case 'tours':
                        endpoint = `/super-admin/tours/${itemId}/toggle-status`;
                        break;
                    case 'guias':
                        endpoint = `/super-admin/guias/${itemId}/toggle-status`;
                        break;
                    default:
                        throw new Error(`Tipo de establecimiento no v√°lido: ${type}`);
                }

                const response = await fetch(`${baseURL}${endpoint}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // ‚úÖ CORRECCI√ìN: Actualizar el elemento en la interfaz
                    const item = allData[type].find(item => item._id === itemId);
                    if (item) {
                        item.activo = !currentStatus; // Cambiar el estado local
                    }
                    
                    showNotification(
                        result.message || `${typeName.charAt(0).toUpperCase() + typeName.slice(1)} ${!currentStatus ? 'activado' : 'bloqueado'} exitosamente`,
                        'success'
                    );
                    
                    // Recargar la vista actual
                    displayData(type);
                    updateStats();
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.message || `Error al ${action} ${typeName}`);
                }
            } catch (error) {
                console.error(`Error toggling ${type} status:`, error);
                showNotification(error.message || `Error al cambiar estado del ${typeName}`, 'error');
            }
        }
                
          //  Eliminar establecimiento
        async function deleteItem(type, itemId) {
            // Mapeo de nombres para mostrar en confirmaci√≥n
            const typeNames = {
                hoteles: 'hotel',
                cabanas: 'caba√±a',
                airbnb: 'alojamiento',
                tours: 'tour operadora',
                guias: 'gu√≠a tur√≠stica'
            };
            
            const typeName = typeNames[type];
            
            // Confirmaci√≥n doble para eliminar
            if (!confirm(`¬øEst√° seguro que desea ELIMINAR este ${typeName}?\n\nEsta acci√≥n NO se puede deshacer.`)) {
                return;
            }
            
            // Segunda confirmaci√≥n
            if (!confirm(`CONFIRME: ¬øRealmente desea eliminar este ${typeName} PERMANENTEMENTE?`)) {
                return;
            }

            try {
                // üî• CAMBIO IMPORTANTE: Usar rutas de super-admin en lugar de rutas individuales
                let endpoint;
                switch(type) {
                    case 'hoteles':
                        endpoint = `/super-admin/hoteles/${itemId}`;
                        break;
                    case 'cabanas':
                        endpoint = `/super-admin/cabanas/${itemId}`;
                        break;
                    case 'airbnb':
                        endpoint = `/super-admin/airbnb/${itemId}`;
                        break;
                    case 'tours':
                        endpoint = `/super-admin/tours/${itemId}`;
                        break;
                    case 'guias':
                        endpoint = `/super-admin/guias/${itemId}`;
                        break;
                }

                const response = await fetch(`${baseURL}${endpoint}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    // ‚úÖ CORRECCI√ìN: Remover el item de los datos locales
                    const index = allData[type].findIndex(item => item._id === itemId);
                    if (index !== -1) {
                        allData[type].splice(index, 1);
                    }
                    
                    // Mostrar notificaci√≥n de √©xito
                    showNotification(
                        `${typeName.charAt(0).toUpperCase() + typeName.slice(1)} eliminado exitosamente`,
                        'success'
                    );
                    
                    // Recargar la vista actual
                    displayData(type);
                    updateStats();
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.message || `Error al eliminar ${typeName}`);
                }
            } catch (error) {
                console.error(`Error deleting ${type}:`, error);
                showNotification(error.message || `Error al eliminar ${typeName}`, 'error');
            }
        }

        // ==================== FUNCIONES DE DESCARGA EXCEL COMPLETAS ====================

        // Funci√≥n auxiliar para formatear reporte para Excel
        function formatReportForExcel(reporte) {
            const establecimiento = reporte.establecimiento;
            const datos = reporte.datos;
            
            return {
                'Establecimiento': establecimiento?.nombre || 'N/A',
                'Tipo': reporte.tipoEstablecimiento === 'hotel' ? 'Hotel' : 
                       reporte.tipoEstablecimiento === 'cabana' ? 'Caba√±a' : 'Airbnb',
                'Ubicaci√≥n': establecimiento?.ubicacion || 'N/A',
                'Per√≠odo Inicio': new Date(reporte.fechaInicio).toLocaleDateString('es-ES'),
                'Per√≠odo Fin': new Date(reporte.fechaFin).toLocaleDateString('es-ES'),
                'Fecha Env√≠o': new Date(reporte.fechaEnvio).toLocaleDateString('es-ES'),
                'Semana-A√±o': reporte.semanaAnio,
                
                // Datos espec√≠ficos seg√∫n el tipo de establecimiento
                'D√≠as Ocupados': datos.diasOcupada || datos.habitacionesOcupadas || 'N/A',
                'Ocupaci√≥n Nacionales': datos.ocupacionNacionales || datos.habitacionesNacionales || 'N/A',
                'Ocupaci√≥n Extranjeros': datos.ocupacionExtranjeros || datos.habitacionesExtranjeros || 'N/A',
                'Total Personas': datos.totalPersonas || 'N/A',
                'Personas Nacionales': datos.turistasNacionales || 'N/A',
                'Personas Extranjeros': datos.turistasExtranjeros || 'N/A',
                'Total Pernoctaciones': datos.totalPernoctaciones || 'N/A',
                'Pernoctaciones Nacionales': datos.pernoctacionesNacionales || 'N/A',
                'Pernoctaciones Extranjeros': datos.pernoctacionesExtranjeros || 'N/A',
                
                'Procedencia de Turistas': datos.procedenciaTuristas || 'N/A',
                'Notas': reporte.notas || 'N/A',
                'Propietario Email': reporte.propietario?.email || 'N/A'
            };
        }

        // Funci√≥n para generar estad√≠sticas
        function generateStatistics(reportes) {
            const stats = [
                { 'Concepto': 'Total de Reportes', 'Valor': reportes.length },
                { 'Concepto': 'Reportes de Hoteles', 'Valor': reportes.filter(r => r.tipoEstablecimiento === 'hotel').length },
                { 'Concepto': 'Reportes de Caba√±as', 'Valor': reportes.filter(r => r.tipoEstablecimiento === 'cabana').length },
                { 'Concepto': 'Reportes de Airbnb', 'Valor': reportes.filter(r => r.tipoEstablecimiento === 'airbnb').length }
            ];
            
            // Calcular totales
            let totalPersonas = 0;
            let totalNacionales = 0;
            let totalExtranjeros = 0;
            let totalPernoctaciones = 0;
            
            reportes.forEach(reporte => {
                const datos = reporte.datos;
                totalPersonas += parseInt(datos.totalPersonas) || 0;
                totalNacionales += parseInt(datos.turistasNacionales) || 0;
                totalExtranjeros += parseInt(datos.turistasExtranjeros) || 0;
                totalPernoctaciones += parseInt(datos.totalPernoctaciones) || 0;
            });
            
            stats.push(
                { 'Concepto': '--- TOTALES ---', 'Valor': '---' },
                { 'Concepto': 'Total Personas', 'Valor': totalPersonas },
                { 'Concepto': 'Total Nacionales', 'Valor': totalNacionales },
                { 'Concepto': 'Total Extranjeros', 'Valor': totalExtranjeros },
                { 'Concepto': 'Total Pernoctaciones', 'Valor': totalPernoctaciones }
            );
            
            return stats;
        }

        // Funci√≥n para descargar un reporte individual
        async function downloadSingleReport(reportId) {
            try {
                showNotification('Preparando descarga del reporte...', 'info');
                
                // Buscar el reporte espec√≠fico en los datos cargados
                const reporte = currentReports.find(r => r._id === reportId);
                if (!reporte) {
                    showNotification('Reporte no encontrado', 'error');
                    return;
                }
                
                // Crear el libro de Excel
                const workbook = XLSX.utils.book_new();
                
                // Preparar datos del reporte individual
                const reportData = formatReportForExcel(reporte);
                
                // Crear hoja de trabajo
                const worksheet = XLSX.utils.json_to_sheet([reportData]);
                
                // Configurar anchos de columna
                const colWidths = [
                    { wch: 20 }, // Establecimiento
                    { wch: 15 }, // Tipo
                    { wch: 12 }, // Per√≠odo Inicio
                    { wch: 12 }, // Per√≠odo Fin  
                    { wch: 12 }, // Fecha Env√≠o
                    { wch: 15 }, // D√≠as Ocupados
                    { wch: 15 }, // Ocupaci√≥n Nac.
                    { wch: 15 }, // Ocupaci√≥n Ext.
                    { wch: 15 }, // Total Personas
                    { wch: 15 }, // Personas Nac.
                    { wch: 15 }, // Personas Ext.
                    { wch: 15 }, // Total Pernoc.
                    { wch: 15 }, // Pernoc. Nac.
                    { wch: 15 }, // Pernoc. Ext.
                    { wch: 50 }, // Procedencia
                    { wch: 30 }  // Notas
                ];
                worksheet['!cols'] = colWidths;
                
                // Agregar hoja al libro
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Reporte');
                
                // Generar nombre del archivo
                const establecimiento = reporte.establecimiento?.nombre || 'Establecimiento';
                const fecha = new Date(reporte.fechaInicio).toLocaleDateString('es-ES').replace(/\//g, '-');
                const filename = `Reporte_${establecimiento}_${fecha}.xlsx`;
                
                // Descargar archivo
                XLSX.writeFile(workbook, filename);
                
                showNotification('Reporte descargado exitosamente', 'success');
                
            } catch (error) {
                console.error('Error al descargar reporte:', error);
                showNotification('Error al generar el archivo Excel', 'error');
            }
        }

        // Funci√≥n para descargar todos los reportes
        async function downloadAllReports() {
            try {
                showNotification('Preparando descarga de todos los reportes...', 'info');
                
                // Verificar que hay reportes disponibles
                if (!currentReports || currentReports.length === 0) {
                    showNotification('No hay reportes disponibles para descargar', 'warning');
                    return;
                }
                
                // Crear el libro de Excel
                const workbook = XLSX.utils.book_new();
                
                // Preparar datos de todos los reportes
                const allReportsData = currentReports.map(reporte => formatReportForExcel(reporte));
                
                // Crear hoja principal con todos los reportes
                const mainWorksheet = XLSX.utils.json_to_sheet(allReportsData);
                
                // Configurar anchos de columna
                const colWidths = [
                    { wch: 25 }, // Establecimiento
                    { wch: 12 }, // Tipo
                    { wch: 12 }, // Per√≠odo Inicio
                    { wch: 12 }, // Per√≠odo Fin  
                    { wch: 12 }, // Fecha Env√≠o
                    { wch: 15 }, // D√≠as Ocupados
                    { wch: 15 }, // Ocupaci√≥n Nac.
                    { wch: 15 }, // Ocupaci√≥n Ext.
                    { wch: 15 }, // Total Personas
                    { wch: 15 }, // Personas Nac.
                    { wch: 15 }, // Personas Ext.
                    { wch: 15 }, // Total Pernoc.
                    { wch: 15 }, // Pernoc. Nac.
                    { wch: 15 }, // Pernoc. Ext.
                    { wch: 50 }, // Procedencia
                    { wch: 30 }  // Notas
                ];
                mainWorksheet['!cols'] = colWidths;
                
                // Agregar hoja principal
                XLSX.utils.book_append_sheet(workbook, mainWorksheet, 'Todos los Reportes');
                
                // Crear hojas separadas por tipo de establecimiento
                const tiposEstablecimiento = ['hotel', 'cabana', 'airbnb'];
                
                tiposEstablecimiento.forEach(tipo => {
                    const reportesPorTipo = currentReports.filter(r => r.tipoEstablecimiento === tipo);
                    
                    if (reportesPorTipo.length > 0) {
                        const dataFiltrada = reportesPorTipo.map(reporte => formatReportForExcel(reporte));
                        const worksheet = XLSX.utils.json_to_sheet(dataFiltrada);
                        worksheet['!cols'] = colWidths;
                        
                        const nombreHoja = tipo === 'hotel' ? 'Hoteles' : 
                                         tipo === 'cabana' ? 'Caba√±as' : 'Airbnb';
                        XLSX.utils.book_append_sheet(workbook, worksheet, nombreHoja);
                    }
                });
                
                // Crear hoja de estad√≠sticas
                const estadisticas = generateStatistics(currentReports);
                const statsWorksheet = XLSX.utils.json_to_sheet(estadisticas);
                statsWorksheet['!cols'] = [{ wch: 25 }, { wch: 15 }];
                XLSX.utils.book_append_sheet(workbook, statsWorksheet, 'Estad√≠sticas');
                
                // Generar nombre del archivo con fecha actual
                const fechaActual = new Date().toLocaleDateString('es-ES').replace(/\//g, '-');
                const filename = `Reportes_Semanales_Completo_${fechaActual}.xlsx`;
                
                // Descargar archivo
                XLSX.writeFile(workbook, filename);
                
                showNotification(`Descargados ${currentReports.length} reportes exitosamente`, 'success');
                
            } catch (error) {
                console.error('Error al descargar todos los reportes:', error);
                showNotification('Error al generar el archivo Excel', 'error');
            }
        }

        // Funci√≥n para descargar reportes con filtros
        async function downloadFilteredReports() {
            try {
                // Aplicar filtros actuales
                applyFilters();
                
                // Usar reportes filtrados
                const filteredReports = getFilteredReports();
                
                if (filteredReports.length === 0) {
                    showNotification('No hay reportes que coincidan con los filtros aplicados', 'warning');
                    return;
                }
                
                showNotification(`Descargando ${filteredReports.length} reportes filtrados...`, 'info');
                
                // Crear libro de Excel con reportes filtrados
                const workbook = XLSX.utils.book_new();
                const reportData = filteredReports.map(reporte => formatReportForExcel(reporte));
                const worksheet = XLSX.utils.json_to_sheet(reportData);
                
                // Configurar anchos de columna
                const colWidths = [
                    { wch: 25 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 12 },
                    { wch: 15 }, { wch: 15 }, { wch: 15 }, { wch: 15 }, { wch: 15 },
                    { wch: 15 }, { wch: 15 }, { wch: 15 }, { wch: 15 }, { wch: 50 }, { wch: 30 }
                ];
                worksheet['!cols'] = colWidths;
                
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Reportes Filtrados');
                
                // Agregar estad√≠sticas de filtros
                const stats = generateStatistics(filteredReports);
                const statsWorksheet = XLSX.utils.json_to_sheet(stats);
                statsWorksheet['!cols'] = [{ wch: 25 }, { wch: 15 }];
                XLSX.utils.book_append_sheet(workbook, statsWorksheet, 'Estad√≠sticas');
                
                // Generar nombre del archivo
                const filterInfo = getCurrentFilterInfo();
                const fechaActual = new Date().toLocaleDateString('es-ES').replace(/\//g, '-');
                const filename = `Reportes_Filtrados_${filterInfo}_${fechaActual}.xlsx`;
                
                XLSX.writeFile(workbook, filename);
                showNotification('Reportes filtrados descargados exitosamente', 'success');
                
            } catch (error) {
                console.error('Error al descargar reportes filtrados:', error);
                showNotification('Error al generar el archivo Excel', 'error');
            }
        }

        // Funci√≥n auxiliar para obtener reportes filtrados
        function getFilteredReports() {
            const tipoFilter = document.getElementById('filterType')?.value;
            const mesFilter = document.getElementById('filterMonth')?.value;
            const anioFilter = document.getElementById('filterYear')?.value;
            
            return currentReports.filter(reporte => {
                // Filtro por tipo
                if (tipoFilter && reporte.tipoEstablecimiento !== tipoFilter) {
                    return false;
                }
                
                // Filtro por mes
                if (mesFilter) {
                    const reporteMes = new Date(reporte.fechaInicio).getMonth() + 1;
                    if (reporteMes.toString() !== mesFilter) {
                        return false;
                    }
                }
                
                // Filtro por a√±o
                if (anioFilter) {
                    const reporteAnio = new Date(reporte.fechaInicio).getFullYear();
                    if (reporteAnio.toString() !== anioFilter) {
                        return false;
                    }
                }
                
                return true;
            });
        }

        // Funci√≥n auxiliar para obtener informaci√≥n de filtros actuales
        function getCurrentFilterInfo() {
            const tipoFilter = document.getElementById('filterType')?.value;
            const mesFilter = document.getElementById('filterMonth')?.value;
            const anioFilter = document.getElementById('filterYear')?.value;
            
            let info = [];
            if (tipoFilter) info.push(tipoFilter);
            if (mesFilter) info.push(`Mes${mesFilter}`);
            if (anioFilter) info.push(anioFilter);
            
            return info.length > 0 ? info.join('_') : 'SinFiltros';
        }

        // ==================== FUNCIONES DE FILTROS Y ESTAD√çSTICAS ====================
        
        // Aplicar filtros a los reportes
        function applyFilters() {
            const tipoFilter = document.getElementById('filterType')?.value;
            const mesFilter = document.getElementById('filterMonth')?.value;
            const anioFilter = document.getElementById('filterYear')?.value;
            
            filteredReports = currentReports.filter(reporte => {
                // Filtro por tipo
                if (tipoFilter && reporte.tipoEstablecimiento !== tipoFilter) {
                    return false;
                }
                
                // Filtro por mes
                if (mesFilter) {
                    const reporteMes = new Date(reporte.fechaInicio).getMonth() + 1;
                    if (reporteMes.toString() !== mesFilter) {
                        return false;
                    }
                }
                
                // Filtro por a√±o
                if (anioFilter) {
                    const reporteAnio = new Date(reporte.fechaInicio).getFullYear();
                    if (reporteAnio.toString() !== anioFilter) {
                        return false;
                    }
                }
                
                return true;
            });
            
            // Actualizar la tabla con reportes filtrados
            populateReportsTableEnhanced(filteredReports);
            updateSummaryStats(filteredReports);
            
            // Mostrar informaci√≥n de filtros
            showFilterInfo(filteredReports.length, currentReports.length);
        }

        // Limpiar todos los filtros
        function clearFilters() {
            document.getElementById('filterType').value = '';
            document.getElementById('filterMonth').value = '';
            document.getElementById('filterYear').value = '';
            
            filteredReports = [...currentReports];
            populateReportsTableEnhanced(filteredReports);
            updateSummaryStats(filteredReports);
            
            showNotification('Filtros limpiados', 'info');
        }

        // Mostrar informaci√≥n de filtros aplicados
        function showFilterInfo(filteredCount, totalCount) {
            const infoElement = document.getElementById('filterInfo');
            if (!infoElement) {
                // Crear elemento de informaci√≥n si no existe
                const filterInfo = document.createElement('div');
                filterInfo.id = 'filterInfo';
                filterInfo.className = 'filter-info';
                document.querySelector('.filters-section').appendChild(filterInfo);
            }
            
            const info = document.getElementById('filterInfo');
            if (filteredCount !== totalCount) {
                info.innerHTML = `
                    <i class="fas fa-info-circle"></i>
                    Mostrando ${filteredCount} de ${totalCount} reportes
                `;
                info.style.display = 'block';
            } else {
                info.style.display = 'none';
            }
        }

        // Actualizar estad√≠sticas en tiempo real
        function updateSummaryStats(reportes) {
            const totalReports = reportes.length;
            const hotelReports = reportes.filter(r => r.tipoEstablecimiento === 'hotel').length;
            const cabanaReports = reportes.filter(r => r.tipoEstablecimiento === 'cabana').length;
            const airbnbReports = reportes.filter(r => r.tipoEstablecimiento === 'airbnb').length;
            
            // Calcular total de turistas
            let totalTourists = 0;
            reportes.forEach(reporte => {
                if (reporte.datos && reporte.datos.totalPersonas) {
                    totalTourists += parseInt(reporte.datos.totalPersonas) || 0;
                }
            });
            
            // Actualizar elementos del DOM
            document.getElementById('totalReports').textContent = totalReports;
            document.getElementById('hotelReports').textContent = hotelReports;
            document.getElementById('cabanaReports').textContent = cabanaReports;
            document.getElementById('airbnbReports').textContent = airbnbReports;
            document.getElementById('totalTourists').textContent = totalTourists.toLocaleString();
            
            // Mostrar el resumen
            document.getElementById('reportsSummary').style.display = 'block';
        }

        // ==================== FUNCIONES DE TABLA MEJORADAS ====================
        
        //  FUNCI√ìN COMPLETAMENTE REDISE√ëADA PARA TABLA DE REPORTES
        function populateReportsTableEnhanced(reportes) {
            const tbody = document.getElementById('reportsTableBody');
            const tableContainer = document.getElementById('reportsTable');
            tbody.innerHTML = '';
            
            // Crear tambi√©n vista de cards para responsive
            let reportsGrid = document.querySelector('.reports-grid');
            if (!reportsGrid) {
                reportsGrid = document.createElement('div');
                reportsGrid.className = 'reports-grid';
                tableContainer.parentNode.insertBefore(reportsGrid, tableContainer);
            }
            reportsGrid.innerHTML = '';
            
            if (reportes.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="12" class="text-center">
                        <div style="padding: 3rem; color: #6c757d;">
                            <i class="fas fa-inbox" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <h3 style="color: #495057; margin-bottom: 0.5rem;">No hay reportes disponibles</h3>
                            <p>Los establecimientos a√∫n no han enviado reportes semanales</p>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }
            
            reportes.forEach((reporte, index) => {
                // CREAR FILA DE TABLA OPTIMIZADA
                const row = document.createElement('tr');
                row.style.animationDelay = `${index * 0.05}s`;
                
                const fechaInicio = new Date(reporte.fechaInicio).toLocaleDateString('es-ES');
                const fechaFin = new Date(reporte.fechaFin).toLocaleDateString('es-ES');
                
                // Detectar tipo de establecimiento
                const esHotel = reporte.tipoEstablecimiento === 'hotel';
                const esAirbnb = reporte.tipoEstablecimiento === 'airbnb';
                const esCabana = reporte.tipoEstablecimiento === 'cabana';
                
                // Obtener informaci√≥n del establecimiento
                let nombreEstablecimiento = 'N/A';
                let ubicacion = 'N/A';
                
                if (esHotel && reporte.hotel) {
                    nombreEstablecimiento = reporte.hotel.nombre || 'Hotel sin nombre';
                    ubicacion = reporte.hotel.ubicacion || 'Sin ubicaci√≥n';
                } else if (esAirbnb && reporte.alojamiento) {
                    nombreEstablecimiento = reporte.alojamiento.nombre || 'Airbnb sin nombre';
                    ubicacion = reporte.alojamiento.ubicacion || 'Sin ubicaci√≥n';
                } else if (esCabana && reporte.cabana) {
                    nombreEstablecimiento = reporte.cabana.nombre || 'Caba√±a sin nombre';
                    ubicacion = reporte.cabana.ubicacion || 'Sin ubicaci√≥n';
                }
                
                // Obtener datos seg√∫n el tipo
                const datos = reporte.datos || {};
                let ocupacion = 'N/A';
                let nacionales = 'N/A';
                let extranjeros = 'N/A';
                
                if (esHotel) {
                    ocupacion = datos.habitacionesOcupadas || 'N/A';
                    nacionales = datos.habitacionesNacionales || 'N/A';
                    extranjeros = datos.habitacionesExtranjeros || 'N/A';
                } else {
                    ocupacion = datos.diasOcupada || datos.ocupacionesSemana || 'N/A';
                    nacionales = datos.ocupacionNacionales || datos.ocupacionesNacionales || 'N/A';
                    extranjeros = datos.ocupacionExtranjeros || datos.ocupacionesExtranjeros || 'N/A';
                }
                
                const totalPersonas = datos.totalPersonas || datos.totalPersonasSemana || 'N/A';
                const personasNacionales = datos.turistasNacionales || datos.personasNacionales || 'N/A';
                const personasExtranjeros = datos.turistasExtranjeros || datos.personasExtranjeros || 'N/A';
                const totalPernoctaciones = datos.totalPernoctaciones || datos.turistasPernoctaron || 'N/A';
                
                // Procedencia truncada para tabla
                const procedencia = datos.procedenciaTuristas || 'N/A';
                const procedenciaTruncada = procedencia.length > 40 ? 
                    procedencia.substring(0, 40) + '...' : procedencia;
                
                // Badge del tipo
                const tipoBadge = esHotel ? 
                    '<span class="badge badge-hotel">Hotel</span>' :
                    esAirbnb ? 
                    '<span class="badge badge-airbnb">Airbnb</span>' :
                    '<span class="badge badge-cabana">Caba√±a</span>';
                
                // ‚úÖ FILA DE TABLA CON DISE√ëO MEJORADO
                row.innerHTML = `
                    <td class="establishment-column">
                        <div class="establecimiento-info">
                            <strong>${nombreEstablecimiento}</strong>
                            <small class="text-muted">üìç ${ubicacion}</small>
                        </div>
                    </td>
                    <td class="type-column">${tipoBadge}</td>
                    <td class="period-column">
                        <div class="periodo-info">
                            <small><strong>${fechaInicio}</strong></small>
                            <small>al <strong>${fechaFin}</strong></small>
                        </div>
                    </td>
                    <td class="stats-column">
                        <span class="stats-cell info">${ocupacion}</span>
                    </td>
                    <td class="stats-column">
                        <span class="stats-cell success">${nacionales}</span>
                    </td>
                    <td class="stats-column">
                        <span class="stats-cell primary">${extranjeros}</span>
                    </td>
                    <td class="stats-column">
                        <span class="stats-cell"><strong>${totalPersonas}</strong></span>
                    </td>
                    <td class="stats-column">
                        <span class="stats-cell success">${personasNacionales}</span>
                    </td>
                    <td class="stats-column">
                        <span class="stats-cell primary">${personasExtranjeros}</span>
                    </td>
                    <td class="stats-column">
                        <span class="stats-cell info">${totalPernoctaciones}</span>
                    </td>
                    <td class="procedencia-column">
                        <div title="${procedencia}" style="cursor: help;">
                            ${procedenciaTruncada}
                        </div>
                    </td>
                    <td class="actions-column">
                        <div class="action-buttons">
                            <button class="btn-download-single" 
                                    onclick="downloadSingleReport('${reporte._id}')" 
                                    title="Descargar Excel">
                                <i class="fas fa-download"></i>
                                <span>Excel</span>
                            </button>
                            <button class="btn-view-details" 
                                    onclick="viewReportDetails('${reporte._id}')" 
                                    title="Ver detalles">
                                <i class="fas fa-eye"></i>
                                <span>Ver</span>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
                
                // ‚úÖ CREAR CARD PARA VISTA RESPONSIVE
                const card = document.createElement('div');
                card.className = 'report-card';
                card.style.animationDelay = `${index * 0.1}s`;
                
                card.innerHTML = `
                    <div class="report-card-header">
                        <div class="report-establishment">
                            <div class="establishment-name">${nombreEstablecimiento}</div>
                            <div class="establishment-info">
                                ${tipoBadge}
                                <span class="establishment-location">üìç ${ubicacion}</span>
                            </div>
                        </div>
                        <div class="report-period">
                            <div><strong>${fechaInicio}</strong></div>
                            <div>al</div>
                            <div><strong>${fechaFin}</strong></div>
                        </div>
                    </div>
                    
                    <div class="report-stats">
                        <div class="stat-item">
                            <span class="stat-value">${ocupacion}</span>
                            <div class="stat-label">Ocupaci√≥n</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" style="color: #28a745;">${nacionales}</span>
                            <div class="stat-label">Nacionales</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" style="color: #007bff;">${extranjeros}</span>
                            <div class="stat-label">Extranjeros</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${totalPersonas}</span>
                            <div class="stat-label">Total Personas</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${totalPernoctaciones}</span>
                            <div class="stat-label">Pernoctaciones</div>
                        </div>
                    </div>
                    
                    <div class="report-actions">
                        <button class="btn-download-single" 
                                onclick="downloadSingleReport('${reporte._id}')" 
                                title="Descargar Excel">
                            <i class="fas fa-download"></i>
                            Descargar Excel
                        </button>
                        <button class="btn-view-details" 
                                onclick="viewReportDetails('${reporte._id}')" 
                                title="Ver detalles completos">
                            <i class="fas fa-eye"></i>
                            Ver Detalles
                        </button>
                    </div>
                `;
                
                reportsGrid.appendChild(card);
            });
            
            // Actualizar estad√≠sticas
            updateSummaryStats(reportes);
        }

        // ==================== FUNCIONES DE MODAL PARA DETALLES ====================

        // Ver detalles completos del reporte
        function viewReportDetails(reportId) {
            const reporte = currentReports.find(r => r._id === reportId);
            if (!reporte) {
                showNotification('Reporte no encontrado', 'error');
                return;
            }
            
            const modalHtml = createReportDetailModal(reporte);
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // Crear modal con detalles del reporte
        function createReportDetailModal(reporte) {
            const establecimiento = reporte.establecimiento;
            const datos = reporte.datos || {};
            
            const fechaInicio = new Date(reporte.fechaInicio).toLocaleDateString('es-ES');
            const fechaFin = new Date(reporte.fechaFin).toLocaleDateString('es-ES');
            const fechaEnvio = new Date(reporte.fechaEnvio).toLocaleDateString('es-ES');
            
            const tipoNombre = reporte.tipoEstablecimiento === 'hotel' ? 'Hotel' :
                              reporte.tipoEstablecimiento === 'cabana' ? 'Caba√±a' : 'Airbnb';
            
            return `
                <div id="reportDetailModal" class="modal" style="display: block;">
                    <div class="modal-content large-modal">
                        <div class="modal-header">
                            <h2>
                                <i class="fas fa-file-alt"></i>
                                Detalles del Reporte - ${establecimiento?.nombre || 'N/A'}
                            </h2>
                            <span class="close" onclick="closeReportDetailModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="report-details-grid">
                                <div class="detail-section">
                                    <h3><i class="fas fa-building"></i> Informaci√≥n del Establecimiento</h3>
                                    <div class="detail-item">
                                        <strong>Nombre:</strong> ${establecimiento?.nombre || 'N/A'}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Tipo:</strong> ${tipoNombre}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Ubicaci√≥n:</strong> ${establecimiento?.ubicacion || 'N/A'}
                                    </div>
                                </div>
                                
                                <div class="detail-section">
                                    <h3><i class="fas fa-calendar"></i> Informaci√≥n del Per√≠odo</h3>
                                    <div class="detail-item">
                                        <strong>Fecha Inicio:</strong> ${fechaInicio}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Fecha Fin:</strong> ${fechaFin}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Fecha Env√≠o:</strong> ${fechaEnvio}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Semana-A√±o:</strong> ${reporte.semanaAnio}
                                    </div>
                                </div>
                                
                                <div class="detail-section">
                                    <h3><i class="fas fa-chart-bar"></i> Datos de Ocupaci√≥n</h3>
                                    <div class="detail-item">
                                        <strong>Ocupaci√≥n Total:</strong> ${datos.diasOcupada || datos.habitacionesOcupadas || 'N/A'}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Ocupaci√≥n Nacionales:</strong> ${datos.ocupacionNacionales || datos.habitacionesNacionales || 'N/A'}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Ocupaci√≥n Extranjeros:</strong> ${datos.ocupacionExtranjeros || datos.habitacionesExtranjeros || 'N/A'}
                                    </div>
                                </div>
                                
                                <div class="detail-section">
                                    <h3><i class="fas fa-users"></i> Datos de Turistas</h3>
                                    <div class="detail-item">
                                        <strong>Total Personas:</strong> ${datos.totalPersonas || 'N/A'}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Turistas Nacionales:</strong> ${datos.turistasNacionales || 'N/A'}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Turistas Extranjeros:</strong> ${datos.turistasExtranjeros || 'N/A'}
                                    </div>
                                </div>
                                
                                <div class="detail-section">
                                    <h3><i class="fas fa-bed"></i> Pernoctaciones</h3>
                                    <div class="detail-item">
                                        <strong>Total Pernoctaciones:</strong> ${datos.totalPernoctaciones || 'N/A'}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Pernoctaciones Nacionales:</strong> ${datos.pernoctacionesNacionales || 'N/A'}
                                    </div>
                                    <div class="detail-item">
                                        <strong>Pernoctaciones Extranjeros:</strong> ${datos.pernoctacionesExtranjeros || 'N/A'}
                                    </div>
                                </div>
                                
                                <div class="detail-section full-width">
                                    <h3><i class="fas fa-map-marker-alt"></i> Procedencia de Turistas</h3>
                                    <div class="detail-item">
                                        <div class="procedencia-full">
                                            ${datos.procedenciaTuristas || 'No especificado'}
                                        </div>
                                    </div>
                                </div>
                                
                                ${reporte.notas ? `
                                <div class="detail-section full-width">
                                    <h3><i class="fas fa-sticky-note"></i> Notas Adicionales</h3>
                                    <div class="detail-item">
                                        <div class="notas-full">
                                            ${reporte.notas}
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="modal-actions">
                                <button class="btn btn-success" onclick="downloadSingleReport('${reporte._id}')">
                                    <i class="fas fa-download"></i>
                                    Descargar Excel
                                </button>
                                <button class="btn btn-secondary" onclick="closeReportDetailModal()">
                                    Cerrar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Cerrar modal de detalles
        function closeReportDetailModal() {
            const modal = document.getElementById('reportDetailModal');
            if (modal) {
                modal.remove();
            }
        }

        // ==================== FUNCIONES DE CARGA  ====================

        // Funci√≥n de carga de reportes 
        async function loadReportsEnhanced() {
            const loadingState = document.getElementById('reportsLoading');
            const tableContainer = document.getElementById('reportsTable');
            const emptyState = document.getElementById('reportsEmpty');
            
            try {
                // Mostrar loading
                loadingState.style.display = 'block';
                tableContainer.style.display = 'none';
                emptyState.style.display = 'none';
                
                // Crear overlay de carga
                const loadingOverlay = document.createElement('div');
                loadingOverlay.className = 'loading-overlay';
                loadingOverlay.innerHTML = `
                    <div class="loading-spinner"></div>
                    <div>Cargando reportes semanales...</div>
                `;
                document.body.appendChild(loadingOverlay);
                
                console.log(' Cargando reportes desde:', `${baseURL}/cuestionarios/mis-cuestionarios`);
                
                const response = await fetch(`${baseURL}/cuestionarios/mis-cuestionarios`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                console.log('Datos recibidos:', data);
                
                if (response.ok && data.status === 'success') {
                    currentReports = data.data.cuestionarios || [];
                    filteredReports = [...currentReports];
                    
                    if (currentReports.length > 0) {
                        populateReportsTableEnhanced(currentReports);
                        tableContainer.style.display = 'block';
                        updateSummaryStats(currentReports);
                        showNotification(`Cargados ${currentReports.length} reportes exitosamente`, 'success');
                    } else {
                        emptyState.style.display = 'block';
                        document.getElementById('reportsSummary').style.display = 'none';
                    }
                } else {
                    throw new Error(data.message || 'Error al cargar reportes');
                }
                
            } catch (error) {
                console.error(' Error:', error);
                showNotification('Error al cargar los reportes: ' + error.message, 'error');
                emptyState.style.display = 'block';
                tableContainer.style.display = 'none';
            } finally {
                loadingState.style.display = 'none';
                
                // Remover overlay de carga
                const overlay = document.querySelector('.loading-overlay');
                if (overlay) {
                    overlay.remove();
                }
            }
        }

        // Reemplazar las funciones originales
        const loadReports = loadReportsEnhanced;
        const populateReportsTable = populateReportsTableEnhanced;

        // ==================== FUNCIONES DE ESTAD√çSTICAS COMPLETAS ====================

        // ==================== FUNCI√ìN PRINCIPAL ====================
        async function generateAdvancedStatistics() {
            try {
                showNotification('Generando estad√≠sticas avanzadas...', 'info');
                
                // Cargar datos si no est√°n disponibles
                if (statisticsData.length === 0) {
                    statisticsData = await loadStatisticsData();
                }
                
                if (statisticsData.length === 0) {
                    showNotification('No hay datos disponibles para generar estad√≠sticas', 'warning');
                    return;
                }
                
                // Aplicar filtros
                const filteredData = applyStatisticsFilters(statisticsData);
                
                if (filteredData.length === 0) {
                    showNotification('No hay datos que coincidan con los filtros seleccionados', 'warning');
                    return;
                }
                
                // Generar todos los an√°lisis
                await Promise.all([
                    generateFechasConcurridasChart(filteredData),
                    generateProcedenciaChart(filteredData),
                    generateTendenciaChart(filteredData),
                    generateTiposChart(filteredData),
                    generateComparisonMetrics(filteredData)
                ]);
                
                showNotification(`Estad√≠sticas generadas exitosamente con ${filteredData.length} reportes`, 'success');
                
            } catch (error) {
                console.error('‚ùå Error al generar estad√≠sticas:', error);
                showNotification('Error al generar estad√≠sticas: ' + error.message, 'error');
            }
        }

        // ==================== CARGAR DATOS ====================
        async function loadStatisticsData() {
            try {
                const response = await fetch(`${baseURL}/cuestionarios/reportes-super-admin`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                return data.data?.cuestionarios || [];
                
            } catch (error) {
                console.error('‚ùå Error al cargar datos estad√≠sticos:', error);
                throw error;
            }
        }

        // ==================== APLICAR FILTROS ====================
        function applyStatisticsFilters(data) {
            let filtered = [...data];
            
            const tipo = document.getElementById('stats-tipo-establecimiento')?.value;
            const periodo = document.getElementById('stats-periodo')?.value;
            const fechaInicio = document.getElementById('stats-fecha-inicio')?.value;
            const fechaFin = document.getElementById('stats-fecha-fin')?.value;
            
            // Filtrar por tipo
            if (tipo && tipo !== 'todos') {
                filtered = filtered.filter(item => item.tipoEstablecimiento === tipo);
            }
            
            // Filtrar por per√≠odo
            if (periodo === 'personalizado' && fechaInicio && fechaFin) {
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                filtered = filtered.filter(item => {
                    const fecha = new Date(item.fechaInicio);
                    return fecha >= inicio && fecha <= fin;
                });
            } else if (periodo !== 'personalizado') {
                const now = new Date();
                let limitDate = new Date();
                
                switch(periodo) {
                    case 'trimestre':
                        limitDate.setMonth(now.getMonth() - 3);
                        break;
                    case 'semestre':
                        limitDate.setMonth(now.getMonth() - 6);
                        break;
                    case 'a√±o':
                        limitDate.setFullYear(now.getFullYear() - 1);
                        break;
                }
                
                filtered = filtered.filter(item => new Date(item.fechaInicio) >= limitDate);
            }
            
            return filtered;
        }

        // ==================== FUNCIONES DE GR√ÅFICOS COMPLETAS ====================
        async function generateFechasConcurridasChart(data) {
            const ctx = document.getElementById('fechasChart');
            if (!ctx) return;
            
            if (statisticsCharts.fechas) {
                statisticsCharts.fechas.destroy();
            }
            
            // Procesar datos por semana
            const weeklyData = processBasicWeeklyData(data);
            
            statisticsCharts.fechas = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeklyData.map(w => w.week),
                    datasets: [{
                        label: 'Personas por Semana',
                        data: weeklyData.map(w => w.totalPersons),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'N√∫mero de Personas' }
                        }
                    }
                }
            });
            
            // Actualizar m√©tricas b√°sicas
            updateElement('total-semanas-analizadas', weeklyData.length);
            updateElement('pico-max-ocupacion', Math.max(...weeklyData.map(w => w.totalPersons)));
            updateElement('semanas-temporada-alta', weeklyData.filter(w => w.totalPersons > 50).length);
        }

        async function generateProcedenciaChart(data) {
            const ctx = document.getElementById('procedenciaChart');
            if (!ctx) return;
            
            if (statisticsCharts.procedencia) {
                statisticsCharts.procedencia.destroy();
            }
            
            // Procesar datos de procedencia
            const originData = processBasicOriginData(data);
            
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6'];
            
            statisticsCharts.procedencia = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: originData.map(o => o.place),
                    datasets: [{
                        data: originData.map(o => o.tourists),
                        backgroundColor: colors,
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });
            
            updateElement('total-lugares-origen', originData.length);
            updateElement('lugar-principal', originData[0]?.place || '-');
        }

        async function generateTendenciaChart(data) {
            const ctx = document.getElementById('tendenciaChart');
            if (!ctx) return;
            
            if (statisticsCharts.tendencia) {
                statisticsCharts.tendencia.destroy();
            }
            
            // Procesar datos por mes
            const monthlyData = processMonthlyTrend(data);
            
            statisticsCharts.tendencia = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthlyData.map(m => m.month),
                    datasets: [{
                        label: 'Turistas por Mes',
                        data: monthlyData.map(m => m.totalTuristas),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Ocupaci√≥n Promedio',
                        data: monthlyData.map(m => m.avgOcupacion),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'N√∫mero de Turistas' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Ocupaci√≥n %' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
            
            // Actualizar m√©tricas
            const avgTuristas = Math.round(monthlyData.reduce((sum, m) => sum + m.totalTuristas, 0) / monthlyData.length);
            const lastMonth = monthlyData[monthlyData.length - 1];
            const prevMonth = monthlyData[monthlyData.length - 2];
            const variation = prevMonth ? ((lastMonth.totalTuristas - prevMonth.totalTuristas) / prevMonth.totalTuristas * 100).toFixed(1) : 0;
            
            updateElement('promedio-mensual', avgTuristas);
            updateElement('variacion-tendencia', `${variation}%`);
            updateElement('direccion-tendencia', variation > 0 ? 'üìà' : variation < 0 ? 'üìâ' : '‚û°Ô∏è');
        }

        async function generateTiposChart(data) {
            const ctx = document.getElementById('tiposChart');
            if (!ctx) return;
            
            if (statisticsCharts.tipos) {
                statisticsCharts.tipos.destroy();
            }
            
            // Procesar datos por tipo
            const typeData = processTypeData(data);
            
            statisticsCharts.tipos = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: typeData.map(t => t.type),
                    datasets: [{
                        label: 'Reportes',
                        data: typeData.map(t => t.reportes),
                        backgroundColor: ['#3498db', '#2ecc71', '#e74c3c'],
                        borderColor: ['#2980b9', '#27ae60', '#c0392b'],
                        borderWidth: 2
                    }, {
                        label: 'Total Turistas',
                        data: typeData.map(t => t.turistas),
                        backgroundColor: ['rgba(52, 152, 219, 0.3)', 'rgba(46, 204, 113, 0.3)', 'rgba(231, 76, 60, 0.3)'],
                        borderColor: ['#2980b9', '#27ae60', '#c0392b'],
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            position: 'left',
                            title: { display: true, text: 'N√∫mero de Reportes' }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            title: { display: true, text: 'Total de Turistas' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
            
            // Actualizar m√©tricas
            const totalTipos = typeData.length;
            const bestPerformer = typeData.reduce((prev, current) => 
                current.turistas > prev.turistas ? current : prev
            );
            const totalHuespedes = typeData.reduce((sum, t) => sum + t.turistas, 0);
            
            updateElement('total-tipos-activos', totalTipos);
            updateElement('mejor-performance', bestPerformer.type);
            updateElement('total-huespedes-periodo', totalHuespedes.toLocaleString());
        }

        async function generateComparisonMetrics(data) {
            try {
                // Obtener per√≠odo actual y anterior
                const currentPeriod = getCurrentPeriodData(data);
                const previousPeriod = await getPreviousPeriodData(data);
                
                const comparisonContainer = document.getElementById('comparison-metrics');
                if (!comparisonContainer) return;
                
                const metrics = [
                    {
                        title: 'Total Reportes',
                        current: currentPeriod.reportes,
                        previous: previousPeriod.reportes,
                        icon: 'fas fa-file-alt'
                    },
                    {
                        title: 'Total Turistas',
                        current: currentPeriod.turistas,
                        previous: previousPeriod.turistas,
                        icon: 'fas fa-users'
                    },
                    {
                        title: 'Ocupaci√≥n Promedio',
                        current: Math.round(currentPeriod.avgOcupacion),
                        previous: Math.round(previousPeriod.avgOcupacion),
                        icon: 'fas fa-percentage',
                        suffix: '%'
                    },
                    {
                        title: 'Pernoctaciones',
                        current: currentPeriod.pernoctaciones,
                        previous: previousPeriod.pernoctaciones,
                        icon: 'fas fa-bed'
                    }
                ];
                
                let metricsHTML = '';
                
                metrics.forEach(metric => {
                    const change = metric.previous > 0 ? 
                        ((metric.current - metric.previous) / metric.previous * 100).toFixed(1) : 0;
                    const isPositive = change > 0;
                    const isNeutral = change == 0;
                    const trendClass = isNeutral ? 'trend-neutral' : (isPositive ? 'trend-up' : 'trend-down');
                    const trendIcon = isNeutral ? '‚û°Ô∏è' : (isPositive ? 'üìà' : 'üìâ');
                    
                    metricsHTML += `
                        <div class="comparison-card">
                            <div class="comparison-value">
                                <i class="${metric.icon}"></i>
                                ${metric.current.toLocaleString()}${metric.suffix || ''}
                            </div>
                            <div class="comparison-label">${metric.title}</div>
                            <div class="comparison-trend ${trendClass}">
                                ${trendIcon} ${Math.abs(change)}%
                            </div>
                        </div>
                    `;
                });
                
                comparisonContainer.innerHTML = metricsHTML;
                
            } catch (error) {
                console.error('Error generando m√©tricas de comparaci√≥n:', error);
                const container = document.getElementById('comparison-metrics');
                if (container) {
                    container.innerHTML = '<div class="loading-stats">Error cargando comparaciones</div>';
                }
            }
        }

        // ==================== FUNCIONES AUXILIARES NUEVAS ====================

        function processBasicWeeklyData(data) {
            const weekMap = new Map();
            
            data.forEach(report => {
                const date = new Date(report.fechaInicio);
                const week = `${date.getFullYear()}-S${getWeekNumber(date)}`;
                
                if (!weekMap.has(week)) {
                    weekMap.set(week, { week, totalPersons: 0 });
                }
                
                weekMap.get(week).totalPersons += report.datos.totalPersonas || 0;
            });
            
            return Array.from(weekMap.values()).sort((a, b) => a.week.localeCompare(b.week));
        }

        function processBasicOriginData(data) {
            const originMap = new Map();
            
            data.forEach(report => {
                const origin = report.datos.procedenciaTuristas || 'No especificado';
                const key = origin.substring(0, 30); // Simplificar
                
                if (!originMap.has(key)) {
                    originMap.set(key, { place: key, tourists: 0 });
                }
                
                originMap.get(key).tourists += report.datos.totalPersonas || 0;
            });
            
            return Array.from(originMap.values()).sort((a, b) => b.tourists - a.tourists).slice(0, 5);
        }

        function processMonthlyTrend(data) {
            const monthMap = new Map();
            
            data.forEach(report => {
                const date = new Date(report.fechaInicio);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                const monthName = date.toLocaleDateString('es-ES', { year: 'numeric', month: 'short' });
                
                if (!monthMap.has(monthKey)) {
                    monthMap.set(monthKey, {
                        month: monthName,
                        totalTuristas: 0,
                        totalOcupacion: 0,
                        reportes: 0
                    });
                }
                
                const monthData = monthMap.get(monthKey);
                monthData.totalTuristas += report.datos.totalPersonas || 0;
                monthData.totalOcupacion += getOcupacionValue(report);
                monthData.reportes++;
            });
            
            return Array.from(monthMap.values())
                .map(m => ({
                    ...m,
                    avgOcupacion: m.reportes > 0 ? m.totalOcupacion / m.reportes : 0
                }))
                .sort((a, b) => a.month.localeCompare(b.month));
        }

        function processTypeData(data) {
            const typeMap = new Map();
            const typeNames = {
                'hotel': 'Hoteles',
                'cabana': 'Caba√±as', 
                'airbnb': 'Airbnb'
            };
            
            data.forEach(report => {
                const type = report.tipoEstablecimiento;
                const typeName = typeNames[type] || type;
                
                if (!typeMap.has(typeName)) {
                    typeMap.set(typeName, {
                        type: typeName,
                        reportes: 0,
                        turistas: 0,
                        ocupacion: 0
                    });
                }
                
                const typeData = typeMap.get(typeName);
                typeData.reportes++;
                typeData.turistas += report.datos.totalPersonas || 0;
                typeData.ocupacion += getOcupacionValue(report);
            });
            
            return Array.from(typeMap.values())
                .sort((a, b) => b.turistas - a.turistas);
        }

        function getCurrentPeriodData(data) {
            return {
                reportes: data.length,
                turistas: data.reduce((sum, r) => sum + (r.datos.totalPersonas || 0), 0),
                avgOcupacion: data.reduce((sum, r) => sum + getOcupacionValue(r), 0) / data.length,
                pernoctaciones: data.reduce((sum, r) => sum + (r.datos.totalPernoctaciones || 0), 0)
            };
        }

        async function getPreviousPeriodData(currentData) {
            try {
                if (currentData.length === 0) {
                    return { reportes: 0, turistas: 0, avgOcupacion: 0, pernoctaciones: 0 };
                }
                
                const currentStart = new Date(Math.min(...currentData.map(r => new Date(r.fechaInicio))));
                const currentEnd = new Date(Math.max(...currentData.map(r => new Date(r.fechaFin))));
                
                const periodDuration = currentEnd - currentStart;
                const previousStart = new Date(currentStart.getTime() - periodDuration);
                const previousEnd = new Date(currentStart.getTime());
                
                const response = await fetch(`${baseURL}/cuestionarios/reportes-super-admin`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const allReports = data.data?.cuestionarios || [];
                    
                    const previousReports = allReports.filter(report => {
                        const reportDate = new Date(report.fechaInicio);
                        return reportDate >= previousStart && reportDate <= previousEnd;
                    });
                    
                    return getCurrentPeriodData(previousReports);
                }
                
                return { reportes: 0, turistas: 0, avgOcupacion: 0, pernoctaciones: 0 };
                
            } catch (error) {
                console.error('Error obteniendo datos del per√≠odo anterior:', error);
                return { reportes: 0, turistas: 0, avgOcupacion: 0, pernoctaciones: 0 };
            }
        }

        function getOcupacionValue(report) {
            const datos = report.datos || {};
            
            switch(report.tipoEstablecimiento) {
                case 'hotel':
                    return datos.habitacionesOcupadas || 0;
                case 'cabana':
                    return datos.diasOcupada || 0;
                case 'airbnb':
                    return datos.ocupacionesSemana || datos.diasOcupada || 0;
                default:
                    return 0;
            }
        }

        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) element.textContent = value;
        }

        // ==================== FUNCIONES DE EXPORTACI√ìN ====================
        async function exportStatisticsExcel() {
            try {
                showNotification('Preparando exportaci√≥n de estad√≠sticas...', 'info');
                
                if (statisticsData.length === 0) {
                    showNotification('No hay datos para exportar', 'warning');
                    return;
                }
                
                const filteredData = applyStatisticsFilters(statisticsData);
                
                // Crear libro Excel
                const workbook = XLSX.utils.book_new();
                
                // Hoja 1: Resumen General
                const resumenData = [{
                    'Concepto': 'Total de Reportes Analizados',
                    'Valor': filteredData.length
                }, {
                    'Concepto': 'Total de Turistas',
                    'Valor': filteredData.reduce((sum, r) => sum + (r.datos.totalPersonas || 0), 0)
                }, {
                    'Concepto': 'Total de Pernoctaciones',
                    'Valor': filteredData.reduce((sum, r) => sum + (r.datos.totalPernoctaciones || 0), 0)
                }, {
                    'Concepto': 'Per√≠odo Analizado',
                    'Valor': `${new Date(Math.min(...filteredData.map(r => new Date(r.fechaInicio)))).toLocaleDateString('es-ES')} - ${new Date(Math.max(...filteredData.map(r => new Date(r.fechaFin)))).toLocaleDateString('es-ES')}`
                }];
                
                const wsResumen = XLSX.utils.json_to_sheet(resumenData);
                XLSX.utils.book_append_sheet(workbook, wsResumen, 'Resumen');
                
                // Hoja 2: Datos por Tipo
                const tipoData = processTypeData(filteredData);
                const wsTipos = XLSX.utils.json_to_sheet(tipoData);
                XLSX.utils.book_append_sheet(workbook, wsTipos, 'Por Tipo');
                
                // Hoja 3: Tendencia Mensual
                const mensualData = processMonthlyTrend(filteredData);
                const wsMensual = XLSX.utils.json_to_sheet(mensualData);
                XLSX.utils.book_append_sheet(workbook, wsMensual, 'Tendencia Mensual');
                
                // Generar archivo
                const fecha = new Date().toLocaleDateString('es-ES').replace(/\//g, '-');
                const filename = `Estadisticas_Turismo_${fecha}.xlsx`;
                
                XLSX.writeFile(workbook, filename);
                showNotification('Estad√≠sticas exportadas a Excel exitosamente', 'success');
                
            } catch (error) {
                console.error('Error exportando estad√≠sticas:', error);
                showNotification('Error al exportar estad√≠sticas', 'error');
            }
        }

        async function exportStatisticsPDF() {
            try {
                showNotification('Generando reporte PDF...', 'info');
                
                const { jsPDF } = window.jsPDF;
                const doc = new jsPDF();
                
                // T√≠tulo
                doc.setFontSize(20);
                doc.text('Reporte de Estad√≠sticas Tur√≠sticas', 20, 30);
                
                // Informaci√≥n b√°sica
                doc.setFontSize(12);
                doc.text(`Fecha de generaci√≥n: ${new Date().toLocaleDateString('es-ES')}`, 20, 50);
                doc.text(`Total de reportes analizados: ${statisticsData.length}`, 20, 65);
                
                // Guardar PDF
                const fecha = new Date().toLocaleDateString('es-ES').replace(/\//g, '-');
                doc.save(`Estadisticas_Turismo_${fecha}.pdf`);
                
                showNotification('Reporte PDF generado exitosamente', 'success');
                
            } catch (error) {
                console.error('Error generando PDF:', error);
                showNotification('Error al generar PDF. Aseg√∫rate de que jsPDF est√© cargado.', 'error');
            }
        }

        function resetStatisticsFilters() {
            document.getElementById('stats-tipo-establecimiento').value = 'todos';
            document.getElementById('stats-periodo').value = 'trimestre';
            document.getElementById('stats-fecha-inicio').value = '';
            document.getElementById('stats-fecha-fin').value = '';
            document.getElementById('custom-dates').style.display = 'none';
            
            showNotification('Filtros restablecidos', 'success');
        }

        // ==================== FUNCIONES ORIGINALES MANTENIDAS ====================
        
        // Ver reporte en modal incluyendo CABA√ëAS
        function viewReport(reportId) {
            const reporte = allData.reportes.find(r => r._id === reportId);
            if (!reporte) {
                showNotification('Reporte no encontrado', 'error');
                return;
            }
            
            // Detectar tipo y preparar datos incluyendo CABA√ëAS
            const esHotel = reporte.tipoEstablecimiento === 'hotel';
            const esAirbnb = reporte.tipoEstablecimiento === 'airbnb';
            const esCabana = reporte.tipoEstablecimiento === 'cabana';
            
            let nombreEstablecimiento, ubicacionEstablecimiento, tipoTexto, iconoTipo, datosHtml;
            
            if (esHotel) {
                nombreEstablecimiento = reporte.hotel?.nombre || 'Hotel sin nombre';
                ubicacionEstablecimiento = `${reporte.hotel?.ubicacion?.ciudad || 'Ciudad N/A'}, ${reporte.hotel?.ubicacion?.estado || 'Estado N/A'}`;
                tipoTexto = 'Hotel';
                iconoTipo = 'üè®';
                
                datosHtml = `
                    <div class="modal-data-grid">
                        <div class="modal-data-item">
                            <span class="modal-data-label">Habitaciones Ocupadas:</span>
                            <span class="modal-data-value">${reporte.datos.habitacionesOcupadas || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Hab. Nacionales:</span>
                            <span class="modal-data-value">${reporte.datos.habitacionesNacionales || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Hab. Extranjeros:</span>
                            <span class="modal-data-value">${reporte.datos.habitacionesExtranjeros || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Total Personas:</span>
                            <span class="modal-data-value">${reporte.datos.totalPersonas || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Turistas Nacionales:</span>
                            <span class="modal-data-value">${reporte.datos.turistasNacionales || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Turistas Extranjeros:</span>
                            <span class="modal-data-value">${reporte.datos.turistasExtranjeros || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Turistas por Noche:</span>
                            <span class="modal-data-value">${reporte.datos.turistasAlMenosUnaNoche || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Nac. por Noche:</span>
                            <span class="modal-data-value">${reporte.datos.turistasNacionalesNoche || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Ext. por Noche:</span>
                            <span class="modal-data-value">${reporte.datos.turistasExtranjerosNoche || 0}</span>
                        </div>
                    </div>
                `;
            } else if (esAirbnb) {
                nombreEstablecimiento = reporte.alojamiento?.nombre || 'Alojamiento sin nombre';
                ubicacionEstablecimiento = `${reporte.alojamiento?.ubicacion?.ciudad || 'Ciudad N/A'}, ${reporte.alojamiento?.ubicacion?.estado || 'Estado N/A'}`;
                tipoTexto = 'Alojamiento Airbnb';
                iconoTipo = 'üè†';
                
                datosHtml = `
                    <div class="modal-data-grid">
                        <div class="modal-data-item">
                            <span class="modal-data-label">Ocupaciones en la Semana:</span>
                            <span class="modal-data-value">${reporte.datos.ocupacionesSemana || 0} d√≠as</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Ocupaciones Nacionales:</span>
                            <span class="modal-data-value">${reporte.datos.ocupacionesNacionales || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Ocupaciones Extranjeros:</span>
                            <span class="modal-data-value">${reporte.datos.ocupacionesExtranjeros || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Total Personas:</span>
                            <span class="modal-data-value">${reporte.datos.totalPersonasSemana || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Personas Nacionales:</span>
                            <span class="modal-data-value">${reporte.datos.personasNacionales || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Personas Extranjeros:</span>
                            <span class="modal-data-value">${reporte.datos.personasExtranjeros || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Turistas que Pernoctaron:</span>
                            <span class="modal-data-value">${reporte.datos.turistasPernoctaron || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Nac. que Pernoctaron:</span>
                            <span class="modal-data-value">${reporte.datos.turistasNacionalesPernoctaron || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Ext. que Pernoctaron:</span>
                            <span class="modal-data-value">${reporte.datos.turistasExtranjerosPernoctaron || 0}</span>
                        </div>
                    </div>
                `;
            } else if (esCabana) {
                nombreEstablecimiento = reporte.cabana?.nombre || 'Caba√±a sin nombre';
                ubicacionEstablecimiento = `${reporte.cabana?.ubicacion?.ciudad || 'Ciudad N/A'}, ${reporte.cabana?.ubicacion?.estado || 'Estado N/A'}`;
                tipoTexto = 'Caba√±a Ecol√≥gica';
                iconoTipo = 'üèîÔ∏è';
                
                datosHtml = `
                    <div class="modal-data-grid">
                        <div class="modal-data-item">
                            <span class="modal-data-label">D√≠as Ocupados:</span>
                            <span class="modal-data-value">${reporte.datos.diasOcupada || 0} d√≠as</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">D√≠as Nacionales:</span>
                            <span class="modal-data-value">${reporte.datos.ocupacionNacionales || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">D√≠as Extranjeros:</span>
                            <span class="modal-data-value">${reporte.datos.ocupacionExtranjeros || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Total Personas:</span>
                            <span class="modal-data-value">${reporte.datos.totalPersonas || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Turistas Nacionales:</span>
                            <span class="modal-data-value">${reporte.datos.turistasNacionales || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Turistas Extranjeros:</span>
                            <span class="modal-data-value">${reporte.datos.turistasExtranjeros || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Total Pernoctaciones:</span>
                            <span class="modal-data-value">${reporte.datos.totalPernoctaciones || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Pernoctaciones Nac.:</span>
                            <span class="modal-data-value">${reporte.datos.pernoctacionesNacionales || 0}</span>
                        </div>
                        <div class="modal-data-item">
                            <span class="modal-data-label">Pernoctaciones Ext.:</span>
                            <span class="modal-data-value">${reporte.datos.pernoctacionesExtranjeros || 0}</span>
                        </div>
                    </div>
                `;
            }
            
            // Crear el modal
            const modalHtml = `
                <div id="reportModal" class="modal-overlay" onclick="closeReportModal(event)">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h2>${iconoTipo} ${nombreEstablecimiento}</h2>
                            <button onclick="closeReportModal()" class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="modal-info">
                                <p><strong>Tipo:</strong> ${tipoTexto}</p>
                                <p><strong>Ubicaci√≥n:</strong> ${ubicacionEstablecimiento}</p>
                                <p><strong>Per√≠odo:</strong> ${new Date(reporte.fechaInicio).toLocaleDateString('es-ES')} - ${new Date(reporte.fechaFin).toLocaleDateString('es-ES')}</p>
                                <p><strong>Fecha de Env√≠o:</strong> ${new Date(reporte.fechaEnvio).toLocaleDateString('es-ES')}</p>
                                <p><strong>Propietario:</strong> ${reporte.propietario?.nombre || 'N/A'}</p>
                                ${reporte.notas ? `<p><strong>Notas:</strong> ${reporte.notas}</p>` : ''}
                            </div>
                            <div class="modal-data">
                                <h3>Datos del Reporte</h3>
                                ${datosHtml}
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button onclick="downloadSingleReport('${reportId}')" class="btn btn-primary">
                                <i class="fas fa-download"></i> Descargar
                            </button>
                            <button onclick="printReport('${reportId}')" class="btn btn-secondary">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                            <button onclick="closeReportModal()" class="btn btn-outline">Cerrar</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Agregar modal al DOM
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function closeReportModal(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('reportModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Funciones adicionales de reportes, PDF y utilidades
        function printReport(reportId) {
            // Implementaci√≥n completa de impresi√≥n de reportes
            console.log('Imprimiendo reporte:', reportId);
            showNotification('Funci√≥n de impresi√≥n en desarrollo', 'info');
        }
        
        function downloadPDF(type) {
            // Implementaci√≥n completa de generaci√≥n de PDF
            console.log('Generando PDF para:', type);
            showNotification('Funci√≥n de PDF en desarrollo', 'info');
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function logout() {
            if (confirm('¬øEst√°s seguro de que deseas cerrar la sesi√≥n de Super Administrador?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('userData');
                window.location.href = '../public/index.html';
            }
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showSection('dashboard');
                        break;
                    case '2':
                        e.preventDefault();
                        showSection('hoteles');
                        break;
                    case '3':
                        e.preventDefault();
                        showSection('cabanas');
                        break;
                    case '4':
                        e.preventDefault();
                        showSection('airbnb');
                        break;
                    case '5':
                        e.preventDefault();
                        showSection('tours');
                        break;
                    case '6':
                        e.preventDefault();
                        showSection('guias');
                        break;
                    case 'r':
                        e.preventDefault();
                        showSection('reportes');
                        break;
                    case 'h':
                        e.preventDefault();
                        showSection('reportes-hoteles');
                        break;
                    case 's':
                        e.preventDefault();
                        showSection('estadisticas');
                        break;
                }
            }
            
            // ESC key to close mobile menu and modals
            if (e.key === 'Escape') {
                document.getElementById('sidebar').classList.remove('active');
                document.getElementById('overlay').classList.remove('active');
                closeReportModal();
                closeCreateModal();
                closeReportDetailModal();
            }
        });
        
        // Auto-refresh data every 5 minutes
        setInterval(() => {
            console.log('üîÑ Auto-refrescando datos del sistema...');
            loadAllData();
        }, 5 * 60 * 1000);
        
        
        console.log('üöÄ Super Admin Dashboard cargado exitosamente');
        console.log('üë§ Usuario:', userData.nombre);
        console.log('üìä Datos cargados:', Object.keys(allData).map(key => `${key}: ${allData[key].length}`).join(', '));
        console.log('‚å®Ô∏è Atajos disponibles: Ctrl+1-6, Ctrl+R, Ctrl+H, Ctrl+S, ESC');
        console.log('üìä Funciones de Excel y Estad√≠sticas cargadas correctamente');
</script>
<!-- Agregar ANTES del cierre </body> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
<!-- Librer√≠as para PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>